<!doctype html>
<html id="html" lang="en">
	<head>
		<title>Dash</title>
		
		<meta name="description" content="">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="assets/css/style.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/agate.min.css">
		
		<link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
	</head>

	<body>
		<div id="div-confirm-popup" class="card border popup popup-dash popup-middle">
			<span id="span-confirm-popup-msg">are you sure?</span><br>
			<button class="btn" onclick="resolve_confirm(false)">no</button>
			<button class="btn" onclick="resolve_confirm(true)">yes</button>
		</div>
		
		<div id="div-notify-popup" class="card border popup popup-dash popup-middle">
			<span id="span-notify-popup-msg">are you sure?</span><br>
			<button class="btn" onclick="resolve_notify()">ok</button>
		</div>
		
		<div id="div-mono-notify-popup" class="card border popup popup-dash popup-middle" style="width: 100%">
			<textarea id="mono-notify-popup-textarea" style="text-align: left; font-family: 'ubuntu mono';"></textarea><br>
			<button class="btn" onclick="document.getElementById('div-mono-notify-popup').style.display='none'">ok</button>
		</div>
		
		<div id="div-waiting-popup" class="card border popup popup-dash popup-middle">
			<span id="span-waiting-popup-msg"></span><br>
			<img src="assets/icons/loading-boxes.svg" class="width-2em spinner no-hover-ico" style="margin-top: 1em">
		</div>
		
		<style>
			.popup {
				display: none;
				position: fixed;
				margin-left: auto;
				margin-right: auto;
				text-align: center;
				width: 500px; 
				max-width: 90%;
				max-height: 66vh;
				overflow-y: scroll;
				z-index: 999;
			}
		
			.popup-top {
				left: 0;
				right: 0;
				top: 0;
				max-height: 95vh;
			}
		
			.popup-middle {
				left: 0;
				right: 0;
				top: 25vh;
			}
		
			.popup-bottom {
				left: 0;
				right: 0;
				bottom: 0;
			}
		
			@media screen and (min-width: 600px) {
				.popup-dash {
					left: 3.5em;
					max-width: calc(90% - 3.5em);
				}
			}
		
			#mono-notify-popup-textarea {
				background: var(--secondary-dark);
				border: 1px solid var(--light-black);
				color: var(--white);
				height: 300px; 
				width: 90%;
				font-family: "ubuntu mono";
				font-size: 0.9em;
				overflow-x:auto;
				padding: 0.25em 0.25em;
				margin: 0.25em 0;
				resize: none;
				text-align: left;
				white-space: pre-wrap;
			}
		
		</style>
		
		<script>
			const root = document.querySelector(':root');
			var hue = 0;
			var cycle_hue = false;
			async function increment_spinner_hue() {
				if(cycle_hue) {
					hue = (hue+50)%360;
					root.style.setProperty('--filter-spinner-color', "invert(53%) sepia(86%) saturate(463%)  hue-rotate(" + hue + "deg) brightness(95%) contrast(87%)");
					setTimeout(increment_spinner_hue, 500);
				}
			}
		
			async function waiting_popup(msg) {
				document.getElementById("span-waiting-popup-msg").innerHTML = msg;
				cycle_hue = true;
				increment_spinner_hue();
				document.getElementById("div-waiting-popup").style.display = "block";
			}
		
			async function resolve_waiting_popup() {
				document.getElementById("div-waiting-popup").style.display = "none";
				cycle_hue = false;
				document.getElementById("span-waiting-popup-msg").innerHTML = "";
			}
		
			function sleep(ms) {
			    return new Promise(resolve => setTimeout(resolve, ms));
			}
		
			var confirm_resolved, confirm_result;
		
			async function resolve_confirm(res) {
				document.getElementById("div-confirm-popup").style.display = "none";
				document.getElementById("div-confirm-popup").style.boxShadow = "0px 0px 3px 1px var(--primary-grey)";
		
				confirm_result = res;
				confirm_resolved = true;
			}
		
			async function confirm_(msg) {
				confirm_resolved = false;
				document.getElementById("span-confirm-popup-msg").innerHTML = msg;
				document.getElementById("div-confirm-popup").style.display = "block";
		
				while(!confirm_resolved) {
					await sleep(250);
				}
		
				return confirm_result;
			}
		
			async function confirm_color(msg, col) {
				document.getElementById("div-confirm-popup").style.boxShadow = "0px 0px 3px 1px " + col;
		
				await confirm_(msg)
			}
		
			var notify_resolved;
		
			async function resolve_notify() {
				notify_resolved = true;
				document.getElementById("div-notify-popup").style.display = "none";
				document.getElementById("div-notify-popup").style.boxShadow = "0px 0px 3px 1px var(--primary-grey)";
			}
		
			async function notify(msg) {
				notify_resolved = false;
				document.getElementById("span-notify-popup-msg").innerHTML = msg;
				document.getElementById("div-notify-popup").style.display = "block";
		
				/*while(!notify_resolved) {
					await sleep(250);
				}*/
			}
		
			async function notify_color(msg, col) {
				document.getElementById("div-notify-popup").style.boxShadow = "0px 0px 3px 1px " + col;
		
				await notify(msg)
			}
		
			async function notify_resp(result) {
				await notify_color(result["response"], (result["successful"] ? "var(--primary-grey)" : "var(--primary-red)"));
			}
			
			async function mono_notify(msg) {
				document.getElementById("mono-notify-popup-textarea").innerHTML = msg;
				document.getElementById("div-mono-notify-popup").style.display = "block";
			}
		</script>

		<script>
			waiting_popup("loading");
		</script>

		<div align="center">
			<div id="menu-bars">
			  <i id="open-menu-icon" class="fa fa-bars" onclick="show_menu()"></i>
			</div>
			
			<div id="menu-page">
			  <div id="menu-cross" >
			    <i id="close-menu-icon" class="fa fa-xmark" onclick="close_menu()"></i>
			  </div>
			
			  <h2 class="noselect" style="cursor: default"><i class='bs-ico bootstrap-cloud-haze no-hover-ico' style="cursor: default"></i> Cloudfort</h2>
			
			  <nav id="nav" class="noselect">
			    <ul>
			      <li class="item li-menu li-dark has-submenu">
			        <button class="submenu-link" onclick="toggle_submenu(0)">dashboard</button>
			        <ul class="submenu" align="center">
			          <li class="subitem"><a onclick="show('index'); close_menu()">home</a></li>
			          <li class="subitem"><a onclick="show('monitor'); close_menu()">monitor</a></li>
			          <li class="subitem"><a onclick="show('terminal'); close_menu()">terminal</a></li>
			          <li class="subitem"><a onclick="show('explorer'); close_menu()">explorer</a></li>
			          <li class="subitem"><a onclick="show('editor'); close_menu()">editor</a></li>
			          <li class="subitem"><a onclick="show('tools'); close_menu()">tools</a></li>
			          <li class="subitem"><a onclick="show('administration'); close_menu()">administration</a></li>
			        </ul>
			      </li>
			
			      <li class="item li-menu li-dark has-submenu">
			        <button class="submenu-link" onclick="toggle_submenu(1)">company</button>
			        <ul class="submenu" align="center">
			          <li class="subitem"><a onclick="show('tos'); close_menu()">tos</a></li>
			          <li class="subitem"><a onclick="show('privacy-policy'); close_menu()">privacy policy</a></li>
			        </ul>
			      </li>
			    </ul>
			  </nav>
			
			  <button id="sign-out-button" class="btn" onclick="sign_out()">sign out</button>
			</div>

			<div id="content" style="display: none;">
				<div id="menu-div">
					<div style="margin: 0 auto">
						<i id="open-menu-icon" class="fa fa-bars menu-ico" onclick="show_menu()"></i><br><br>
						<i title="home" class="bs-ico bootstrap-house menu-ico" onclick="show('index')"></i><br>
						<hr>
						<i title="monitor" class="bs-ico bootstrap-activity menu-ico" onclick="show('monitor')"></i><br>
						<i title="terminal" class="bs-ico bootstrap-terminal menu-ico" onclick="show('terminal')"></i><br>
						<i title="explorer" class="bs-ico bootstrap-folder menu-ico" onclick="show('explorer')"></i><br>
						<i title="editor" class="bs-ico bootstrap-code-square menu-ico" onclick="show('editor')"></i><br>
						<hr>
						<i title="tools" class="bs-ico bootstrap-tools menu-ico" onclick="show('tools')"></i><br>
						<i title="administration" class="bs-ico bootstrap-gear menu-ico" onclick="show('administration')"></i><br>
					</div>
				</div>

				<div id="banner-div">
					<h2 id="h2-Cloudfort" style="color: white; margin-top: -0.125em; margin-left: 2.5em">Cloudfort</h2>
				</div>

				<div id="index-div" class="main-div">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    dash
						</div>
						
						<h1 style="margin: 0.5em 0">Dashboard</h1>
						
						<div class="card border-hover" title="alt m" onclick="show('monitor')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-activity width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">monitor</h2>
						</div>
						
						<div class="card border-hover" title="alt t" onclick="show('terminal')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-terminal width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">terminal</h2>
						</div>
						
						<div class="card border-hover" title="alt x" onclick="show('explorer')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-folder width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">explorer</h2>
						</div>
						
						<div class="card border-hover" title="alt e" onclick="show('editor')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-code-square width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">editor</h2>
						</div>
						
						<div class="card border-hover" onclick="show('tools')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-tools width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">tools</h2>
						</div>
						
						<div class="card border-hover" onclick="show('administration')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-gear width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">admin</h2>
						</div>
					</div>
				</div>

				<div id="monitor-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/monitor
						</div>
						
						<select id="select-monitor-sort" class="noselect secondary-select" onchange="fetch_top()" style="margin: 0.25em; width: 300px">
							<option value="cpu">cpu</option>
							<option value="memory" selected>memory</option>
						</select>
						
						<div id="textarea-monitor" spellcheck="false"></div>
						
						<script>
							const monitor = document.getElementById("textarea-monitor");
						
							async function fetch_top() {
								if(document.getElementById("monitor-div").style.display != "none") {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									if(document.getElementById("select-monitor-sort").value == "memory")
										formData.append("command", "top -bn1 -o %MEM -w 120")
									else
										formData.append("command", "top -bn1 -w 120")
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									//monitor.innerHTML = result["output"];
									monitor.innerHTML = hljs.highlightAuto(result).value;
						
									setTimeout(function(){fetch_top()}, 3000);
								}
							}
						
							async function monitor_init() {
								if(config["monitor"] && config["monitor"]["sort-by"] == "cpu") {
									document.getElementById("select-monitor-sort").value = "cpu";
								}
							}
						</script>
						
						<style>
							#textarea-monitor {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:auto;
								padding: 0.25em 0em;
								margin: 0.25em 0em;
								resize: none;
								text-align: left;
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="terminal-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/terminal
						</div>
						
						<select id="select-terminal-mode" class="noselect" onchange="select_terminal_mode_event()" style="margin: 0.25em 0 0; width: 300px; max-width: 90%">
						</select>
						<div id="textarea-terminal" style="text-align: left; margin: 0.5em 0;"></div>
						<input id="input-terminal-pw" placeholder="password" type="password" onkeydown="terminal_pw_keypress(event)" style="display: none;">
						<input id="input-terminal" placeholder="cmd" spellcheck="false" onkeydown="terminal_keypress(event)" autocomplete="off"><br>
						<select id="select-hist" class="noselect" onchange="hist_event()">
							<option value="none" disabled hidden selected>history</option>
						</select>
						
						<script>
							const hist_select = document.getElementById("select-hist");
							var prev_cmd, cmd, twd;
							var hist_no = 0;
							var finished = true;
							var mode = "pty";
						
							var socket;
						
							function desanitize_terminal(str) {
							    str = str.replaceAll("\\n", "\n");
							    str = str.replaceAll("\\t", "\t");
							    str = str.replaceAll("\\\"", "\"");
							    //str = str.replaceAll("\\r", "\r");
						
								//var re = /\n.*\\r/g
								//str = str.replaceAll(re, "\n");
						
								if(str.indexOf('') < str.indexOf('\n') || str.indexOf('\n') == -1) {
									str = str.substring(str.indexOf('')+1, str.length);
								}
						
								re = /\n.*/g
								str = str.replaceAll(re, "\n");
						
								str = str.replaceAll("[00m", "</span>");
								str = str.replaceAll("[m", "<span style='color: white; background: var(--secondary-dark)'>");
								str = str.replaceAll("[K", "<span style='color: white; background: var(--secondary-dark)'>");
								str = str.replaceAll("[0m", "<span style='color: white; background: var(--secondary-dark)''>");
								str = str.replaceAll("[1m", "<span style='font-weight: bold; background: var(--secondary-dark)''>");
								//str = str.replaceAll("[2m", "<span style='font-weight: lighter; background: var(--secondary-dark)''>");
								//str = str.replaceAll("[3m", "<span style='font-style: italic; background: var(--secondary-dark)''>");
								//str = str.replaceAll("[4m", "<span style='text-decoration: underline; background: var(--secondary-dark)''>");
						
								str = str.replaceAll("[?7l", "");
								str = str.replaceAll("[?25l", "");
								str = str.replaceAll("[?7h", "");
								str = str.replaceAll("[?25h", "");
								str = str.replaceAll("[20A", "");
								str = str.replaceAll("(B", "");
								str = str.replaceAll("[9999999D", "");
								str = str.replaceAll("[?2004l", "");
						
								str = str.replaceAll("[30m", "<span style='color: var(--sherb-green)'>");
								str = str.replaceAll("[31m", "<span style='color: var(--sherb-red)'>");
								str = str.replaceAll("[32m", "<span style='color: var(--sherb-blue)'>");
								str = str.replaceAll("[33m", "<span style='color: var(--sherb-orange)'>");
								str = str.replaceAll("[34m", "<span style='color: var(--sherb-yellow)'>");
								str = str.replaceAll("[35m", "<span style='color: var(--sherb-purple)'>");
								str = str.replaceAll("[36m", "<span style='color: var(--sherb-pink)'>");
								str = str.replaceAll("[37m", "<span style='color: var(--sherb-pink)'>");
								str = str.replaceAll("[40m", "<span style='color: var(--neon-green)'>");
								str = str.replaceAll("[41m", "<span style='color: var(--neon-red)'>");
								str = str.replaceAll("[42m", "<span style='color: var(--neon-blue)'>");
								str = str.replaceAll("[42C", "<span style='color: var(--sorbet-purple)'>>");
								str = str.replaceAll("[43m", "<span style='color: var(--neon-orange)'>");
								str = str.replaceAll("[43C", "<span style='color: var(--neon-orange)'>");
								str = str.replaceAll("[44m", "<span style='color: var(--neon-yellow)'>");
								str = str.replaceAll("[44C", "");
								str = str.replaceAll("[45m", "<span style='color: var(--neon-purple)'>");
								str = str.replaceAll("[45C", "<span style='color: var(--neon-purple)'>");
								str = str.replaceAll("[46m", "<span style='color: var(--neon-pink)'>");
								str = str.replaceAll("[46C", "");
								str = str.replaceAll("[47m", "<span style='color: var(--neon-pink)'>");
								str = str.replaceAll("[47C", "");
						
						
								str = str.replaceAll("[38;5;8m", "<span style='background: var(--sherb-green); color: transparent'>");
								str = str.replaceAll("[38;5;9m", "<span style='background: var(--sherb-red); color: transparent'>");
								str = str.replaceAll("[38;5;10m", "<span style='background: var(--sherb-blue); color: transparent'>");
								str = str.replaceAll("[38;5;11m", "<span style='background: var(--sherb-purple); color: transparent'>");
								str = str.replaceAll("[38;5;12m", "<span style='background: var(--sherb-pink); color: transparent'>");
								str = str.replaceAll("[38;5;13m", "<span style='background: var(--sherb-orange); color: transparent'>");
								str = str.replaceAll("[38;5;14m", "<span style='background: var(--sherb-yellow); color: transparent'>");
								str = str.replaceAll("[38;5;15m", "<span style='background: var(--neon-pink); color: transparent'>");
						
								str = str.replaceAll("[38;2;0;95;215m", "<span style='color: var(--neon-purple)'>");
								str = str.replaceAll("[38;2;0;175;255m", "<span style='color: var(--neon-green)'>");
						
								str = str.replaceAll("[48;5;8m", "");
								str = str.replaceAll("[48;5;9m", "");
								str = str.replaceAll("[48;5;10m", "");
								str = str.replaceAll("[48;5;11m", "");
								str = str.replaceAll("[48;5;12m", "");
								str = str.replaceAll("[48;5;13m", "");
								str = str.replaceAll("[48;5;14m", "");
								str = str.replaceAll("[48;5;15m", "");
						
								str = str.replaceAll("[1;31m", "<span style='color: var(--sherb-red)'>");
								str = str.replaceAll("[01;31m", "<span style='color: var(--sorbet-purple)'>");
								str = str.replaceAll("[01;32m", "<span style='color: var(--sorbet-green)'>");
								str = str.replaceAll("[01;34m", "<span style='color: var(--sorbet-pink)'>");
								str = str.replaceAll("[01;36m", "<span style='color: var(--sherb-pink)'>");
								str = str.replaceAll("[30;42m", "<span style='color: var(--sherb-orange)'>");
								str = str.replaceAll("[30;43m", "<span style='color: var(--sherb-yellow)'>");
								str = str.replaceAll("[34;42m", "<span style='color: var(--neon-pink)'>");
								str = str.replaceAll("[37;41m", "<span style='color: var(--sherb-blue)'>");
								str = str.replaceAll("[39;49m", "<span style='color: var(--sorbet-purple)'>");
						
								while(str.indexOf("\\b") != -1)
							        str = str.replace(/.\\b/, "");
						
							    return str;
							}
						
							function remove_backspaces(str)
							{
							    while(str.indexOf("\b") != -1)
							        str = str.replace(/.\x08/, "");
							    return str;
							}
						
							async function add_prompt() {
								if(mode == "pty" || mode == "interactive" || mode == "non-interactive") {
									if(document.getElementById("textarea-terminal").innerHTML != "" && document.getElementById("textarea-terminal").innerHTML[document.getElementById("textarea-terminal").innerHTML.length-1] != '\n')
										document.getElementById("textarea-terminal").innerHTML += "\n";
									document.getElementById("textarea-terminal").innerHTML += "<span style='color: var(--sorbet-pink)'>" + twd + "</span>$ ";
								}
								document.getElementById("textarea-terminal").scrollTop = document.getElementById("textarea-terminal").scrollHeight;
							}
						
							async function hist_event() {
								document.getElementById("input-terminal").value = hist_select.value;
								document.getElementById("input-terminal").focus();
								hist_select.value = "none";
							}
						
							async function available_shells() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "tail -n +2 /etc/shells");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								var paths = result.split('\n');
								var shells = new Set();
						
								for(var i=0; i<paths.length; ++i) {
									if(paths[i] != "") {
										shells.add(paths[i].substring(paths[i].lastIndexOf('/')+1, paths[i].length));
									} 
								}
						
								return shells;
							}
						
							async function run(cmd) {
								document.getElementById("input-terminal").value = cmd;
								show('terminal');
								await run_cmd();
							}
						
							async function run_cmd() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
						
								cmd = document.getElementById("input-terminal").value;
						
								if(cmd.length && cmd[0] == ' ')
									cmd = cmd.slice(1);
								else if(cmd.length > 1 && cmd != prev_cmd) {
									prev_cmd = cmd;
									var opt = document.createElement('option');
								    opt.value = cmd;
								    opt.innerHTML = cmd;
								    hist_select.appendChild(opt);
								}
								hist_no = hist_select.options.length;
						
								if(document.getElementById("input-terminal").value.length) {
									if(mode == "pty" || mode == "interactive" || mode == "non-interactive") {
										if(document.getElementById("input-terminal").value[0] != " ") {
											document.getElementById("textarea-terminal").innerHTML += document.getElementById("input-terminal").value + "\n";
										}
										else if(document.getElementById("textarea-terminal").innerHTML.length && document.getElementById("textarea-terminal").innerHTML[document.getElementById("textarea-terminal").innerHTML.length-1] != '\n')
											document.getElementById("textarea-terminal").innerHTML += "\n";
									}
								}
								document.getElementById("input-terminal").value = "";
						
								if(!finished && cmd == "clear") {
									var terminal_ta = document.getElementById("textarea-terminal");
									terminal_ta.innerHTML = terminal_ta.innerHTML.substring(terminal_ta.innerHTML.lastIndexOf('\n')+1, terminal_ta.innerHTML.length);
								}
						
								if(mode != "pty" && mode != "interactive" && mode != "non-interactive") {
									if(cmd.split(" ")[0] == "cd") {
										var dir = cmd.split(" ")[1];
						
										if(dir[0] == '~' && home.length)
											dir = home + dir.substring(1, dir.length);
						
										formData.append("command", "cd " + twd + "; " + cmd + " 2> /dev/null; pwd");
						
										let response = await fetch("/api/run", {
											method: "POST",
											headers: {
												//"content-type": "application/json"
												"signature": signature(date)
										    },
									        body: formData
										});
										let result = await response.text();
						
										var otwd = twd;
										twd = result.replaceAll("\n", "");
						
										if(twd.substring(0, home.length) == home)
											twd = "~" + twd.substring(home.length, twd.length);
						
										if(twd == otwd && dir != "./" && dir != twd) 
											document.getElementById("textarea-terminal").innerHTML += "cd: " + dir + ": no such directory\n";
									}
								}
						
								if(finished && cmd == "clear") {
									document.getElementById("textarea-terminal").innerHTML = "";
						
									add_prompt();
								}
								else if(finished && cmd.split(" ")[0] == "edit") {
									var path = cmd.split(" ")[1];
									if(path[0] == '/' || path[0] == '~')
										edit_file(path);
									else
										edit_file(twd + "/" + cmd.split(" ")[1]);
						
									add_prompt();
								}
								else if(finished && cmd.split(" ")[0] == "cd") {
									var dir = cmd.split(" ")[1];
						
									if(dir[0] == '~' && home.length)
										dir = home + dir.substring(1, dir.length);
						
									formData.append("command", "cd " + twd + "; " + cmd + " 2> /dev/null; pwd");
						
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
								        body: formData
									});
									let result = await response.text();
						
									var otwd = twd;
									twd = result.replaceAll("\n", "");
						
									if(twd.substring(0, home.length) == home)
										twd = "~" + twd.substring(home.length, twd.length);
						
									if(twd == otwd && dir != "./" && dir != twd) 
										document.getElementById("textarea-terminal").innerHTML += "cd: " + dir + ": no such directory\n";
						
									add_prompt();
								}
								else if(finished && cmd.split(" ")[0] == "CD") {
									var dir = cmd.split(" ")[1];
						
									if(dir[0] == '~' && home.length)
										dir = home + dir.substring(1, dir.length);
						
									formData.append("dir", dir);
						
									let response = await fetch("/api/cd", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
								        body: formData
									});
									let result = await response.text();
						
									await get_pwd();
									twd = pwd;
						
									if(twd.substring(0, home.length) == home)
										twd = "~" + twd.substring(home.length, twd.length);
						
									document.getElementById("textarea-terminal").innerHTML += result;
									add_prompt();
								}
								else if(mode != "non-interactive") {
									if(!finished) {
										socket.send(cmd);
									}
									else {
										finished = false;
										socket.send("cd " + twd + "; " + cmd);
									}
								}
								else {
									try {
										formData.append("command", "cd " + twd + "; " + cmd);
						
										let response = await fetch("/api/run", {
											method: "POST",
											headers: {
												//"content-type": "application/json"
										    	//"content-type": "application/x-www-form-urlencoded"
										    	"signature": signature(date)
										    },
									        body: formData
										});
										let result = await response.text();
						
										document.getElementById("textarea-terminal").innerHTML += result;
										document.getElementById("textarea-terminal").innerHTML = remove_backspaces(document.getElementById("textarea-terminal").innerHTML);
										add_prompt();
									}
									catch(error) {
										notify("error: " + error);
									}
								}
							}
						
							async function select_terminal_mode_event() {
								mode = document.getElementById("select-terminal-mode").value;
								finished = true;
								if(mode != "non-interactive") {
									if(mode == "interactive") {
										if(window.location.protocol == "http:")
											socket = new WebSocket("ws://" + window.location.host + "/api/socket/run");
										else
											socket = new WebSocket("wss://" + window.location.host + "/api/socket/run");
									}
									else {
										if(window.location.protocol == "http:")
											socket = new WebSocket("ws://" + window.location.host + "/api/socket/pty");
										else
											socket = new WebSocket("wss://" + window.location.host + "/api/socket/pty");
									}
						
									socket.onmessage = function (e) {
										if(e.data == "[finished]") {
											finished = true;
											add_prompt();
						
											if(mode != "pty" && mode != "interactive" && mode != "non-interactive") {
												document.getElementById("input-terminal").value = " " + mode;
												run_cmd();
											}
						
											if(document.getElementById('input-terminal-pw').style.display == "inline") {
												document.getElementById('input-terminal-pw').style.display = "none";
										  		document.getElementById('input-terminal').style.display = "inline";
										  		document.getElementById('input-terminal').focus();
										  	}
										}
										else if(e.data == "invalid signature") {
											document.getElementById("input-terminal").disabled = true;
											document.getElementById("textarea-terminal").innerHTML = "websocket handshake failed";
										}
										else {
											if(e.data.toLowerCase().search("password") != -1) {
												document.getElementById('input-terminal').style.display = "none";
										  		document.getElementById('input-terminal-pw').style.display = "inline";
										  		document.getElementById('input-terminal-pw').placeholder = "password";
										  		document.getElementById('input-terminal-pw').focus();
											}
											else if(e.data.toLowerCase().search("passphrase") != -1) {
												document.getElementById('input-terminal').style.display = "none";
										  		document.getElementById('input-terminal-pw').style.display = "inline";
										  		document.getElementById('input-terminal-pw').placeholder = "passphrase";
										  		document.getElementById('input-terminal-pw').focus();
						
											}
						
											document.getElementById("textarea-terminal").innerHTML += e.data;
											document.getElementById("textarea-terminal").innerHTML = desanitize_terminal(document.getElementById("textarea-terminal").innerHTML);
											document.getElementById("textarea-terminal").scrollTop = document.getElementById("textarea-terminal").scrollHeight;
										}
								    };
						
								    //signature handshake
									socket.onopen = () => {
										var date = new Date().getTime().toString();
										socket.send(date);
										socket.send(signature(date));
						
										if(mode != "pty" && mode != "interactive") {
											document.getElementById("input-terminal").value = " " + mode;
											run_cmd();
										}
									}
								}
						
								if(document.getElementById("textarea-terminal").innerHTML != "") 
									document.getElementById("textarea-terminal").innerHTML += "\n";
								
								if(mode == "pty" || mode == "interactive" || mode == "non-interactive")
									add_prompt();
						
								document.getElementById("input-terminal").focus();
							}
						
							async function terminal_init() {
								twd = pwd;
								if(twd.substring(0, home.length) == home)
									twd = "~" + twd.substring(home.length, twd.length);
						
								terminal_mode_select = document.getElementById("select-terminal-mode");
								shells = await available_shells();
								const sh_it = shells.values();
								for(const it of sh_it) {
									var opt = document.createElement('option');
								    opt.value = opt.innerHTML = it;
								    terminal_mode_select.appendChild(opt);
								}
						
								var opt = document.createElement('option');
							    opt.value = opt.innerHTML = "pty";
							    terminal_mode_select.appendChild(opt)
							    var opt = document.createElement('option');
							    opt.value = opt.innerHTML = "interactive";
							    terminal_mode_select.appendChild(opt)
							    var opt = document.createElement('option');
							    opt.value = opt.innerHTML = "non-interactive";
							    terminal_mode_select.appendChild(opt)
						
								if(config["terminal"] && config["terminal"]["mode"])
									document.getElementById("select-terminal-mode").value = config["terminal"]["mode"];
								else
									document.getElementById("select-terminal-mode").value = "pty";
						
								await select_terminal_mode_event();
						
								//add_prompt();
							}
						
							async function terminal_pw_keypress(e) {
								var name = e.key;
								var code = e.code;
						
								if(name == 'Enter' || code == 'Enter') {
									e.preventDefault();
						
									document.getElementById('input-terminal').value = " " + document.getElementById('input-terminal-pw').value;
									document.getElementById('input-terminal-pw').value = "";
						
							  		run_cmd();
						
							  		document.getElementById('input-terminal-pw').style.display = "none";
							  		document.getElementById('input-terminal').style.display = "inline";
							  		document.getElementById('input-terminal').focus();
								}
								else if(e.altKey) {
									if(e.key == 'c') {
										e.preventDefault();
										document.getElementById('input-terminal-pw').value = "";
										document.getElementById('input-terminal-pw').style.display = "none";
								  		document.getElementById('input-terminal').style.display = "inline";
								  		document.getElementById('input-terminal').focus();
										document.getElementById("textarea-terminal").innerHTML += "kill\n";
										socket.send("kill");
						
										/*setTimeout(function(){
											if(mode != "pty" && mode != "interactive" && mode != "non-interactive") {
												document.getElementById("input-terminal").value = " " + mode;
												run_cmd();
											}
										}, 500);*/
									}
									else if(e.key == 'p') {
										e.preventDefault();
						
										document.getElementById('input-terminal-pw').value = "";
										document.getElementById('input-terminal-pw').style.display = "none";
								  		document.getElementById('input-terminal').style.display = "inline";
								  		document.getElementById('input-terminal').focus();
									}
								}
							}
						
							async function terminal_keypress(e) {
								var name = e.key;
								var code = e.code;
						
								//alert(name)
						
								if(name == 'ArrowUp' || code == 'ArrowUp') {
									e.preventDefault();
						
									if(hist_no > 1) {
										document.getElementById("input-terminal").value = hist_select.options[--hist_no].value;
									}
						
									setTimeout(function(){ document.getElementById("input-terminal").selectionStart = document.getElementById("input-terminal").selectionEnd = 1000; }, 0);
								}
								else if(name == 'ArrowDown' || code == 'ArrowDown') {
									e.preventDefault();
						
									if(hist_no + 1 < hist_select.options.length) {
										document.getElementById("input-terminal").value = hist_select.options[++hist_no].value;
						
										setTimeout(function(){ document.getElementById("input-terminal").selectionStart = document.getElementById("input-terminal").selectionEnd = 1000; }, 0);
									}
									else if(hist_no < hist_select.options.length) {
										++hist_no;
										document.getElementById("input-terminal").value = "";
									}
								}
								else if(name == 'Enter' || code == 'Enter' || e.keyCode == 13) {
									e.preventDefault();
						
							  		run_cmd();
								}
								else if(e.altKey) {
									if(e.key == 'c') {
										e.preventDefault();
										document.getElementById("textarea-terminal").innerHTML += "kill\n";
										socket.send("kill");
						
										/*setTimeout(function(){
											if(mode != "pty" && mode != "interactive" && mode != "non-interactive") {
												document.getElementById("input-terminal").value = " " + mode;
												run_cmd();
											}
										}, 500);*/
									}
									else if(e.key == 'p') {
										e.preventDefault();
						
										document.getElementById('input-terminal').style.display = "none";
								  		document.getElementById('input-terminal-pw').style.display = "inline";
								  		document.getElementById('input-terminal-pw').focus();
									}
								}
								else if(name == 'Tab') {
									e.preventDefault();
						
									var input = document.getElementById("input-terminal").value;
									var pos = document.getElementById("input-terminal").selectionStart;
						
									var pspace = input.lastIndexOf(' ', pos-1);;
									var pslash = input.lastIndexOf('/', pos);;
						
									var dir = "";
									if(pslash > pspace)
										dir = input.substring(pspace + 1, pslash + 1);
									else
										dir = twd;
									var str;
									if(pslash > pspace)
										str = input.substring(pslash + 1, pos);
									else
										str = input.substring(pspace + 1, pos);
						
									if(dir[0] != '/' && dir[0] != '~')
										dir = twd + "/" + dir;
						
									//don't make this else if
									if(dir[0] == '~')
										dir = home + dir.substring(1, dir.length);
						
									//alert("'" + dir + "'\n'" + str + "'");
						
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("dir", dir);
									formData.append("str", str);
						
									response = await fetch("/api/tab", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									result = await response.text();
						
									var options = result.split(" ");
						
									if(options.length == 1 && options[0] != "") {
										document.getElementById("input-terminal").value = input.substring(0, pos) + options[0].substring(str.length, options[0].length) + input.substring(pos, input.length);
						
										setTimeout(function(){document.getElementById("input-terminal").selectionStart = document.getElementById("input-terminal").selectionEnd = pos + options[0].length - str.length; }, 0);
									}
									else if(options.length > 1) {
										var substr = options[0];
										for(var i=1; i<options.length; i++) {
											if(options[i].length < substr.length)
												substr = substr.substring(0, options[i].length)
						
											for(var j=0; j<substr.length; j++) {
												if(substr[j] != options[i][j]) {
													substr = substr.substring(0, j);
													break;
												}
											}
										}
						
										if(substr != str) {
											document.getElementById("input-terminal").value = input.substring(0, pos) + substr.substring(str.length, substr.length) + input.substring(pos, input.length);
						
											setTimeout(function(){document.getElementById("input-terminal").selectionStart = document.getElementById("input-terminal").selectionEnd = pos + substr.length - str.length; }, 0);
										}
										else {
											document.getElementById("textarea-terminal").innerHTML += document.getElementById("input-terminal").value + "\n";
											document.getElementById("textarea-terminal").innerHTML += result + "\n";
											add_prompt();
										}					
									}
								}
							}
						</script>
						
						<style>
							#textarea-terminal, #input-terminal, #input-terminal-pw, #select-hist {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								font-family: "ubuntu mono";
								max-width: 100%; 
								width: 100%; 
								overflow-y: scroll;
						
								-ms-box-sizing:border-box;
								-moz-box-sizing:border-box;
								-webkit-box-sizing:border-box; 
								box-sizing:border-box;
							}
						
							#select-terminal-mode, #select-terminal-shell {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								font-family: "ubuntu mono";
							}
						
							#select-hist {
								margin-top: 0.5em;
								margin-left: 0;
								padding-left: 0;
							}
						
							#textarea-terminal {
								resize: none;
								height: calc(100vh - 9.5em); 
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="explorer-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/explorer
						</div>
						
						<div class="card border">
							<span id="span-pwd"></span>
						</div><br>
						
						<div class="card border noselect" style="overflow-x: scroll; white-space: nowrap; max-width: 90%;">
							<i title="root" class='bs-ico bootstrap-slash ico-link-color' onclick="get_dir('')"></i> &nbsp;
							<i title="home" class='bs-ico bootstrap-house ico-link-color' onclick="get_dir(home)"></i> &nbsp;&nbsp;
							<i title="refresh" class='bs-ico bootstrap-arrow-repeat ico-link-color' onclick="get_dir(bwd)"></i> &nbsp;&nbsp;
							<i title="new directory" class='bs-ico bootstrap-folder-plus ico-link-color' onclick="show_create_dir()"></i> &nbsp;&nbsp;
							<i title="new file" class='bs-ico bootstrap-file-earmark-plus ico-link-color' onclick="show_create_file()"></i> &nbsp;&nbsp;
							<i title="edit" class='bs-ico bootstrap-code-square ico-link-color' onclick="edit_selected_files()"></i> &nbsp;&nbsp;
							<i title="open in terminal" class='bs-ico bootstrap-terminal ico-link-color' onclick="open_in_terminal()"></i> &nbsp;&nbsp;
							<i title="run" class='bs-ico bootstrap-alt ico-link-color' onclick="show_run_cmd()"></i> &nbsp;&nbsp;
							<i title="compress" class='bs-ico bootstrap-box ico-link-color' onclick="show_compress_file()"></i> &nbsp;&nbsp;
							<i title="extract" class='bs-ico bootstrap-file-zip ico-link-color' onclick="extract_paths()"></i> &nbsp;&nbsp;
							<i title="upload" class='bs-ico bootstrap-cloud-arrow-up ico-link-color' onclick="show_upload_file()"></i> &nbsp;&nbsp;
							<i title="url" class='bs-ico bootstrap-cloud-arrow-down ico-link-color' onclick="show_fetch_url()"></i> &nbsp;&nbsp;
							<i title="download" class='bs-ico bootstrap-download ico-link-color' onclick="download_files()"></i> &nbsp;&nbsp;
							<i title="copy/move" class='bs-ico bootstrap-box-arrow-right ico-link-color' onclick="show_mv_paths()"></i> &nbsp;&nbsp;
							<i title="rename" class='bs-ico bootstrap-input-cursor-text ico-link-color' onclick="show_rename_path()"></i> &nbsp;&nbsp;
							<i title="delete" class='bs-ico bootstrap-trash ico-link-color' onclick="rm_paths()"></i>
						</div><br>
						
						<div id="download-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<table id="table-downloads">
							</table><br>
						
							<button class="btn" onclick="document.getElementById('download-popup').style.display = 'none'" style="width: 100px; margin: 0 auto">close</button>
						</div>
						
						<div id="serve-img-popup" class="card card-shadow-no-hover popup popup-dash popup-top" style="width: 90%; max-height: 95vh; margin-top: 2.5em; overflow-x: scroll">
							<img id="img-serve" style="min-width: 200px; max-height: 80vh; vertical-align: middle; margin-bottom: 1em;"><br>
						
							<button class="btn" onclick="document.getElementById('serve-img-popup').style.display = 'none'" style="width: 100px; margin: 0 auto">close</button>
							<a id="serve-img-download-btn"><button class="btn" style="width: 100px; margin: 0 auto">download</button></a>
						</div>
						
						<div id="serve-video-popup" class="card card-shadow-no-hover popup popup-dash popup-top" style="width: 100%; height: 100%">
							<video id="video-serve" controls loop playsinline style="width: 100%; height: 93%"><source id="serve-video-source" type="video/mp4"></video><br>
						
							<button class="btn" onclick="document.getElementById('video-serve').pause(); document.getElementById('serve-video-popup').style.display = 'none'" style="width: 100px; margin: 0 auto">close</button>
							<a id="serve-video-download-btn"><button class="btn" style="width: 100px; margin: 0 auto">download</button></a>
						</div>
						
						<div id="card-fetch-url" class="card border" style="display: none">
							<input id="input-fetch-url" placeholder="url" style="width: 300px; max-width: 90%;">
							<button class="btn" onclick="fetch_url()">fetch</button>
						</div>
						
						<div id="card-run-cmd" class="card border" style="display: none">
							<input id="input-explorer-cmd" placeholder="cmd" style="width: 400px; max-width: 90%">
							<button class="btn" onclick="explorer_run_cmd()">run</button>
						</div>
						
						<div id="card-input-name" class="card border" style="display: none">
							<input id="input-name" placeholder="name">
							<button id="create_dir_button"  class="btn" onclick="create_dir()" style="display: none">create</button>
							<button id="create_file_button" class="btn" onclick="create_file()" style="display: none">create</button>
						</div>
						
						<div id="card-input-compress" class="card border" style="display: none">
							<input id="input-name-compress" placeholder="name" style="width:200px">
							<select id="select-compress" style="margin: 0.25em; width: 75px">
								<option value=".tar.xz" selected>.tar.xz</option>
								<option value=".tar.gz">.tar.gz</option>
								<option value=".tar.bz2">.tar.bz2</option>
								<option value=".zip">.zip</option>
							</select>
							<button  class="btn" onclick="compress_paths()">compress</button>
						</div>
						
						<div id="card-input-upload" class="card border" style="display: none">
							<div class="dropzone">
								<div id="span-dropzone" style="padding: 0.25em 0; overflow-x: hidden; white-space: nowrap; font-size: 1em">drop or select</div>
								<input id="input-file" type="file" class="upload-input" onchange="display_filename()" />
							</div>
							<button id="upload_button"  class="btn" onclick="upload_file()">upload</button>
						</div>
						
						<div id="card-input-rename" class="card border" style="display: none">
							<input id="input-name-current" placeholder="current path" style="width: 300px"><br>
							<input id="input-name-new" placeholder="new path" style="width: 300px"><br>
							<button id="duplicate_path_button"  class="btn" onclick="duplicate_path()">duplicate</button>
							<button id="rename_path_button"  class="btn" onclick="rename_path()">rename</button>
						</div>
						
						<div id="card-input-mv" class="card border" style="display: none">
							<input id="input-mv-path" placeholder="path">
							<button  class="btn" onclick="cp_paths()">copy</button>
							<button  class="btn" onclick="mv_paths()">move</button>
						</div>
						
						<div class="card border" id="card-browser" style="max-width: 90%; margin-bottom: 1em;">
							<table id="table-files" style="white-space: nowrap">
								<tr>
									<th><input type='checkbox' id='checkbox-all' onchange='select_all_event()' style='vertical-align: middle;'></th>
									<th></th>
									<th onclick='toggle_sort(1)' style="margin-right:100px; cursor: pointer;">name</th>
									<th onclick='toggle_sort(2)' style="cursor: pointer;">size</th>
									<th onclick='toggle_sort(3)' style="cursor: pointer;">modified</th>
								</tr>
							</table>
						</div>
						
						<style>
							input[type=checkbox] {
								position: relative;
								cursor: pointer;
						    }
						    input[type=checkbox]:before {
								content: "";
								display: block;
								position: absolute;
								width: 12px;
								height: 12px;
								top: 0;
								left: 2px;
								border: 1px solid grey;
								border-radius: 4px;
								background-color: var(--secondary-dark);
							}
						    input[type=checkbox]:checked:after {
								content: "";
								display: block;
								width: 3px;
								height: 8px;
								border: solid white;
								border-width: 0 2px 2px 0;
								-webkit-transform: rotate(45deg);
								-ms-transform: rotate(45deg);
								transform: rotate(45deg);
								position: absolute;
								top: 0px;
								left: 6px;
							}
						
							.dropzone {
								margin-top: 0.15em;
								width: 300px;
								height: 30px;
								border: 1px dashed #999;
								border-radius: 3px;
								text-align: center;
							}
						
							.upload-icon {
								vertical-align: middle;
							}
						
							.upload-input {
								cursor: pointer;
								position: relative;
								top: -28px;
								left: 0;
								width: 100%;
								height: 30px;
								opacity: 0;
							}
						
							#table-files, #table-downloads {
								margin: 0 auto; 
								text-align: left;
						
								display: block;
								overflow-x: scroll;
								max-height: calc(100vh - 14.5em);
								overflow-y: scroll;
							}
						
							#card-browser {
								/*height: calc(100vh - 14em);*/
							}
						</style>
						
						<script>
							const files_table = document.getElementById("table-files");
							var bwd = "nil"; //browser working directory
							var explorer_files;
							var file_no;
						
							var sort_indx = 1;
							var sort_dir = 1;
						
							async function select_all_event() {
								//document.getElementById('checkbox-parent').checked = document.getElementById('checkbox-all').checked;
								for(var f=0; f<explorer_files.length; ++f) {
									document.getElementById('checkbox-' + f).checked = document.getElementById('checkbox-all').checked;
								}
							}
						
							async function hide_input_cards() {
								document.getElementById("card-fetch-url").style.display = "none";
								document.getElementById("card-run-cmd").style.display = "none";
								document.getElementById("card-input-upload").style.display = "none";
								document.getElementById("card-input-mv").style.display = "none";
								document.getElementById("card-input-rename").style.display = "none";
								document.getElementById("card-input-name").style.display = "none";
								document.getElementById("card-input-compress").style.display = "none";
								document.getElementById("create_dir_button").style.display = "none";
								document.getElementById("create_file_button").style.display = "none";
							}
						
							async function show_fetch_url() {
								if(document.getElementById("card-fetch-url").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-fetch-url").style.display = "block";
									document.getElementById("input-fetch-url").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function show_run_cmd() {
								if(document.getElementById("card-run-cmd").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-run-cmd").style.display = "block";
									document.getElementById("input-explorer-cmd").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function show_create_dir() {
								if(document.getElementById("create_dir_button").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-input-name").style.display = "block";
									document.getElementById("create_dir_button").style.display = "inline-flex";
									document.getElementById("input-name").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function show_create_file() {
								if(document.getElementById("create_file_button").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-input-name").style.display = "block";
									document.getElementById("create_file_button").style.display = "inline-flex";
									document.getElementById("input-name").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function show_compress_file() {
								if(document.getElementById("card-input-compress").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-input-compress").style.display = "block";
									document.getElementById("input-name-compress").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function show_upload_file() {
								if(document.getElementById("card-input-upload").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-input-upload").style.display = "block";
								}
								else {
									hide_input_cards();
								}
							}
						
							async function display_filename() {
								document.getElementById("span-dropzone").innerHTML = document.getElementById("input-file").value.split('\\').pop();
							}
						
							async function show_rename_path() {
								if(document.getElementById("card-input-rename").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-input-rename").style.display = "block";
									document.getElementById("input-name-current").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function show_mv_paths() {
								if(document.getElementById("card-input-mv").style.display == "none") {
									hide_input_cards();
									document.getElementById("card-input-mv").style.display = "block";
									document.getElementById("input-mv-path").focus();
								}
								else {
									hide_input_cards();
								}
							}
						
							async function create_dir() {
								var dirname = document.getElementById("input-name").value;
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", bwd + "/" + dirname);
						
								response = await fetch("/api/dir/create", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								get_dir(bwd);
						
								document.getElementById("input-name").value = "";
								document.getElementById("card-input-name").style.display = "none";
								document.getElementById("create_dir_button").style.display = "none";
							}
						
							async function create_file() {
								var filename = document.getElementById("input-name").value;
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", bwd + "/" + filename);
						
								response = await fetch("/api/file/create", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								get_dir(bwd);
						
								document.getElementById("input-name").value = "";
								document.getElementById("card-input-name").style.display = "none";
								document.getElementById("create_file_button").style.display = "none";
							}
						
							async function edit_selected_files() {
								var paths = "";
								var count = 0;
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										if(explorer_files[f][0]) {
											await notify("cannot edit directories");
										}
										else {
											++count;
											await edit_file(bwd + "/" + explorer_files[f][1]);
										}
									}
								}
						
								if(!count) {
									notify("nothing selected")
								}
							}
						
							async function extract_path(path) {
								if(await confirm_("extract file?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
						
									var ext = path.substring(path.indexOf('.'), path.length);
						
									if(ext == ".zip") 
										formData.append("command", "cd " + bwd + "; unzip " + path);
									else 
										formData.append("command", "cd " + bwd + "; tar -xf " + path);
						
									response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									result = await response.text();
						
									if(result != "") {
										await notify(result.replaceAll("\n", "<br>"));
									}
								}
						
								get_dir(bwd);
							}
						
							async function extract_paths() {
								var paths = "";
								var count = 0;
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										++count;
										var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);
						
										const date = new Date().getTime().toString();
										const formData = new FormData();
										formData.append("date", date);
						
										if(ext == ".zip") 
											formData.append("command", "cd " + bwd + "; unzip " + explorer_files[f][1]);
										else 
											formData.append("command", "cd " + bwd + "; tar -xf " + explorer_files[f][1]);
						
										response = await fetch("/api/run", {
											method: "POST",
											headers: {
												//"content-type": "application/json"
												"signature": signature(date)
										    },
											body: formData
										});
										result = await response.text();
						
										if(result != "") {
											notify(result.replaceAll("\n", "<br>"));
										}
									}
								}
						
								if(!count) {
									notify("nothing selected")
								}
						
								get_dir(bwd);
							}
						
							async function compress_paths() {
								var paths = "";
								var first = true;
								var count = 0;
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										if(first)
											first = false;
										else
											paths += " ";
										paths += explorer_files[f][1];
										document.getElementById('checkbox-' + f).checked = false;
										++count;
									}
								}
						
								if(count) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									//https://stackoverflow.com/a/27785347
									if(document.getElementById("select-compress").value == ".tar.xz") {
										formData.append("command", "tar -C " + bwd + "/ -c " + paths + " | xz > " + bwd + "/" + document.getElementById("input-name-compress").value + ".tar.xz");
									}
									else if(document.getElementById("select-compress").value == ".tar.gz") {
										formData.append("command", "tar -czf " + bwd + "/" + document.getElementById("input-name-compress").value + document.getElementById("select-compress").value + " -C " + bwd + "/ "  + paths);
									}
									else if(document.getElementById("select-compress").value == ".tar.bz2") {
										formData.append("command", "tar -C " + bwd + "/ -c " + paths + " | bzip2 > " + bwd + "/" + document.getElementById("input-name-compress").value + ".tar.bz2");
									}
									else if(document.getElementById("select-compress").value == ".zip") {
										formData.append("command", "cd " + bwd + "; zip -r " + bwd + "/" + document.getElementById("input-name-compress").value + ".zip " + paths);
									}
						
									response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									result = await response.text();
						
									get_dir(bwd);
								}
								else {
									notify("nothing selected")
								}
						
								document.getElementById("input-mv-path").value = "";
								document.getElementById("card-input-mv").style.display = "none";
							}
						
							async function upload_file() {
								const fileField = document.getElementById("input-file");
						
								if(!fileField.files.length) {
									notify("No file chosen");
									return;
								}
						
								waiting_popup("uploading " + fileField.value.split('\\').pop());
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", bwd + "/" + fileField.value.split('\\').pop());
								formData.append("file", fileField.files[0]);
						
								response = await fetch("/api/upload", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								resolve_waiting_popup();
						
								get_dir(bwd);
						
								document.getElementById("card-input-upload").style.display = "none";
							}
						
							async function fetch_url() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								//formData.append("command", "wget -q -O " + bwd + "/" + document.getElementById("input-fetch-url").value.split('?')[0].split('/').pop() + " " + document.getElementById("input-fetch-url").value);
								formData.append("command", "cd " + bwd + "; wget " + document.getElementById("input-fetch-url").value);
						
								waiting_popup("downloading " + document.getElementById("input-fetch-url").value);
						
								response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								resolve_waiting_popup();
						
								get_dir(bwd);
						
								document.getElementById("input-fetch-url").value = "";
								document.getElementById("card-fetch-url").style.display = "none";
							}
						
							async function open_in_terminal() {
								twd = bwd;
								document.getElementById("textarea-terminal").innerHTML += "\n";
								add_prompt();
								show('terminal');
							}
						
							async function explorer_run_cmd() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "cd " + bwd + "; " + document.getElementById("input-explorer-cmd").value);
						
						
								waiting_popup(document.getElementById("input-explorer-cmd").value);
						
								response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								resolve_waiting_popup();
								get_dir(bwd);
						
								document.getElementById("input-explorer-cmd").value = "";
								document.getElementById("card-run-cmd").style.display = "none";
						
								if(result != "") {
									await mono_notify(result);
								}
							}
						
							async function clear_downloads_table() {
								const downloads_table = document.getElementById("table-downloads");
						
								while(downloads_table.rows.length > 0)
									downloads_table.deleteRow(0);
							}
						
							async function download_files() {
								const downloads_table = document.getElementById("table-downloads");
								var r = 0;
						
								clear_downloads_table();
						
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										if(explorer_files[f][0]) {
											await notify("cannot download directories");
										}
										else {
											const date = new Date().getTime().toString();
											const formData = new FormData();
											formData.append("date", date);
											formData.append("path", bwd + "/" + explorer_files[f][1]);
						
											response = await fetch("/api/download", {
												method: "POST",
												headers: {
													//"content-type": "application/json"
													"signature": signature(date)
											    },
												body: formData
											});
											var blob = await response.blob();
						
											var file = window.URL.createObjectURL(blob);
						
											var row = downloads_table.insertRow(0);
											row.insertCell(0).innerHTML = explorer_files[f][1];
											row.insertCell(1).innerHTML = "<a id='download-link-" + f + "' download><button class='btn'>download</button></a>";
											document.getElementById("download-link-"+ f).href = file;
											document.getElementById("download-link-"+ f).download = explorer_files[f][1];
											document.getElementById("download-link-"+ f).click();
											
							    			//window.location.assign(file);
										}
									}
								}
							}
						
							function is_img_ext(ext) {
								return (ext == ".png" || ext == ".jpg" || ext == ".jpeg" || ext == ".webp" || ext == ".svg" || ext == ".gif");
							}
						
							function is_video_ext(ext) {
								return (ext == ".mp4" || ext == ".ogg" || ext == ".webm");
							}
						
							function is_archive_ext(ext) {
								return (ext == ".zip" || ext == ".xz" || ext == ".bz2" || ext == ".gz");
							}
						
							async function serve_image(f) {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", bwd + "/" + explorer_files[f][1]);
						
								response = await fetch("/api/download", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								var blob = await response.blob();
						
								var file = window.URL.createObjectURL(blob);
								//window.location.assign(file);
						
								document.getElementById("serve-img-download-btn").href = file;
								document.getElementById("serve-img-download-btn").download = explorer_files[f][1];
								file_no = f;
						
								document.getElementById('img-serve').src = file;
								document.getElementById('img-serve').title = explorer_files[f][1];
								document.getElementById('serve-img-popup').style.display = "block";
							}
						
							async function serve_image_increment() {
								var f = file_no;
								f = (f+1)%explorer_files.length;
								while(f != file_no) {
									var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);
									if(is_img_ext(ext)) {
										serve_image(f);
										break;
									}
									f = (f+1)%explorer_files.length;
								}
							}
						
							async function serve_image_decrement() {
								var f = file_no;
								f--;
								if(f < 0)
									f = explorer_files.length-1;
								while(f != file_no) {
									var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);
									if(is_img_ext(ext)) {
										serve_image(f);
										break;
									}
									f--;
									if(f < 0)
										f = explorer_files.length-1;
								}
							}
						
							async function serve_video(f) {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", bwd + "/" + explorer_files[f][1]);
						
								response = await fetch("/api/download", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								var blob = await response.blob();
						
								var file = window.URL.createObjectURL(blob);
								//window.location.assign(file);
						
								document.getElementById('serve-video-popup').style.display = "block";
						
								var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);
								if(ext == ".mp4")
									document.getElementById('serve-video-source').type = "video/mp4";
								else if(ext == ".ogg")
									document.getElementById('serve-video-source').type = "video/ogg";
								else if(ext == ".webm")
									document.getElementById('serve-video-source').type = "video/webm";
								document.getElementById('video-serve').src = file;
								document.getElementById('video-serve').title = explorer_files[f][1];
								document.getElementById('video-serve').play();
						
								document.getElementById("serve-video-download-btn").href = file;
								document.getElementById("serve-video-download-btn").download = explorer_files[f][1];
								file_no = f;
							}
						
							async function serve_video_increment() {
								var f = file_no;
								f = (f+1)%explorer_files.length;
								while(f != file_no) {
									var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);
									if(is_video_ext(ext)) {
										serve_video(f);
										break;
									}
						
									f = (f+1)%explorer_files.length;
								}
							}
						
							async function serve_video_decrement() {
								var f = file_no;
								f--;
								if(f < 0)
									f = explorer_files.length-1;
								while(f != file_no) {
									var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);
									if(is_video_ext(ext)) {
										serve_video(f);
										break;
									}
						
									f--;
									if(f < 0)
										f = explorer_files.length-1;
								}
							}
						
							async function rename_path() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path-old", bwd + "/" + document.getElementById("input-name-current").value);
								formData.append("path-new", bwd + "/" + document.getElementById("input-name-new").value);
						
								response = await fetch("/api/rename", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								get_dir(bwd);
						
								document.getElementById("input-name-current").value = "";
								document.getElementById("input-name-new").value = "";
								document.getElementById("card-input-rename").style.display = "none";
							}
						
							async function duplicate_path() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "cd " + bwd + "; cp -rf " + document.getElementById("input-name-current").value + " " + document.getElementById("input-name-new").value);
						
								response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								result = await response.text();
						
								get_dir(bwd);
						
								document.getElementById("input-name-current").value = "";
								document.getElementById("input-name-new").value = "";
								document.getElementById("card-input-rename").style.display = "none";
							}
						
							async function mv_paths() {
								var paths = "";
								var first = true;
								var count = 0;
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										if(first)
											first = false;
										else
											paths += " ";
										paths += bwd + "/" + explorer_files[f][1];
										document.getElementById('checkbox-' + f).checked = false;
										++count;
									}
								}
						
								if(count) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("paths", paths);
									formData.append("path", bwd + "/" + document.getElementById("input-mv-path").value);
						
									response = await fetch("/api/mv", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									result = await response.text();
						
									get_dir(bwd);
								}
								else {
									notify("nothing selected")
								}
						
								document.getElementById("input-mv-path").value = "";
								document.getElementById("card-input-mv").style.display = "none";
							}
						
							async function cp_paths() {
								var paths = "";
								var first = true;
								var count = 0;
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										if(first)
											first = false;
										else
											paths += " ";
										paths += bwd + "/" + explorer_files[f][1];
										document.getElementById('checkbox-' + f).checked = false;
										++count;
									}
								}
						
								if(count) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "cp -rf " + paths + " " + bwd + "/" + document.getElementById("input-mv-path").value);
						
									response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									result = await response.text();
						
									get_dir(bwd);
								}
								else {
									notify("nothing selected")
								}
						
								document.getElementById("input-mv-path").value = "";
								document.getElementById("card-input-mv").style.display = "none";
							}
						
							async function rm_paths() {
								if(!await confirm_("permanently delete files?")) {
									return;
								}
						
								var paths = "";
								var first = true;
								var count = 0;
								for(var f=0; f<explorer_files.length; ++f) {
									if(document.getElementById('checkbox-' + f).checked) {
										if(first)
											first = false;
										else
											paths += " ";
										paths += bwd + "/" + explorer_files[f][1];
										document.getElementById('checkbox-' + f).checked = false;
										++count;
									}
								}
						
								if(count) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("paths", paths);
						
									response = await fetch("/api/rm", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									result = await response.text();
						
									get_dir(bwd);
								}
								else {
									notify("nothing selected")
								}
							}
						
							async function clear_explorer_table() {
								while(files_table.rows.length > 1)
									files_table.deleteRow(1);
							}
						
							function sort_data()
							{
								if(sort_indx == 1 || sort_indx == 3)
								{
									explorer_files.sort(function(obj1, obj2) {
										if(obj1[sort_indx].toLowerCase() > obj2[sort_indx].toLowerCase())
											return sort_dir*1;
										else if(obj1[sort_indx] == obj2[sort_indx])
											return 0;
										else return sort_dir*-1;
									});
								}
								else
								{
									explorer_files.sort(function(obj1, obj2) {
										return sort_dir*(obj1[sort_indx] - obj2[sort_indx]);
									});
								}
						
								//draw_table();
							}
						
							function toggle_sort(indx)
							{
								if(sort_indx == indx)
									sort_dir *= -1;
								else
								{
									sort_indx = indx;
									sort_dir = 1;
								}
						
								get_dir(bwd);
							}
						
							async function get_dir(dir) {
								clear_explorer_table();
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
						
								bwd = dir;
								document.getElementById("span-pwd").innerHTML = "";
								var dirs = [], files = [];
						
								var cwd = bwd;
								if(cwd.substring(0, home.length) == home)
									    cwd = "~" + cwd.substring(home.length, cwd.length);
						
								while(cwd.lastIndexOf("/") >= 0) {
									dirs.push(cwd);
									files.push(cwd.substring(cwd.lastIndexOf('/')+1, cwd.length+1))
									//alert(cwd);
									//alert(cwd.substring(cwd.lastIndexOf('/')+1, cwd.length+1))
									cwd = cwd.substring(0, cwd.lastIndexOf('/'))
								}
						
								if(cwd == '~')
									document.getElementById("span-pwd").innerHTML += "<a onclick='get_dir(\"" + home + "\")'>~</a>/"
								else
									document.getElementById("span-pwd").innerHTML += "/"
						
								for(var i=dirs.length-1; i>=0; --i) {
									document.getElementById("span-pwd").innerHTML += "<a onclick='get_dir(\"" + dirs[i].replace("~", home) + "\")'>" + files[i] + "</a>/"
								}
						
								if(dir[0] == '~' && home.length)
									dir = home + dir.substring(1, dir.length);
								else if(dir == "")
									dir = "/";
						
								formData.append("dir", dir);
								response = await fetch("/api/ls", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
							        body: formData
								});
								result = await response.json();
								explorer_files = result["files"];
						
								//sorts files
								sort_data();
						
								for(var f=result["files"].length-1; f>=0; --f) {
									var row = files_table.insertRow(1);
						
									var ext = result["files"][f][1].substring(result["files"][f][1].lastIndexOf('.'), result["files"][f][1].length).toLowerCase();
						
									row.insertCell(0).innerHTML = "<input type='checkbox' id='checkbox-" + f + "' style='vertical-align: middle;'>"
						
									if(result["files"][f][0])
										row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-folder no-hover-ico' style='padding-top: 3px'></i>";
									else {
										if(is_img_ext(ext))
											row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-file-earmark-image no-hover-ico' style='padding-top: 3px'></i>";
										else if(is_video_ext(ext))
											row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-film no-hover-ico' style='padding-top: 3px'></i>";
										else if(is_archive_ext(ext))
											row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-file-zip no-hover-ico' style='padding-top: 3px'></i>";
										else
											row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-file-earmark no-hover-ico' style='padding-top: 3px'></i>";
									}
						
									if(result["files"][f][0]) {
										row.insertCell(2).innerHTML = "<a onclick='get_dir(\"" + bwd + "/" + result["files"][f][1] +  "\")'>" + result["files"][f][1] + "/</a>";
									}
									else {
										if(is_img_ext(ext))
											row.insertCell(2).innerHTML = "<a onclick='serve_image(" + f + ")'>" + result["files"][f][1] + "</a>";
										else if(is_video_ext(ext))
											row.insertCell(2).innerHTML = "<a onclick='serve_video(" + f + ")'>" + result["files"][f][1] + "</a>";
										else if(is_archive_ext(ext))
											row.insertCell(2).innerHTML = "<a onclick='extract_path(\"" + bwd + "/" + result["files"][f][1] +  "\")'>" + result["files"][f][1] + "</a>";
										else
											row.insertCell(2).innerHTML = "<a onclick='edit_file(\"" + bwd + "/" + result["files"][f][1] +  "\")'>" + result["files"][f][1] + "</a>";
										//else
											//row.insertCell(2).innerHTML = result["files"][f][1];
									}
						
									/*if(result["files"][f][0]) {
										row.insertCell(3);
										row.insertCell(4);
									}
									else*/ {
										if(result["files"][f][2] < 1000)
											row.insertCell(3).innerHTML = result["files"][f][2] + "b";
										else if(result["files"][f][2] < 1000000)
											row.insertCell(3).innerHTML = (result["files"][f][2]/1000).toFixed(2) + "kb";
										else
											row.insertCell(3).innerHTML = (result["files"][f][2]/1000000).toFixed(2) + "mb";
						
										row.insertCell(4).innerHTML = result["files"][f][3];
									}
								}
						
								if(dir != "/") 
								{
									var row = files_table.insertRow(1);
									var par = bwd.substring(0, bwd.lastIndexOf("/"));
									row.insertCell(0).innerHTML = "<input type='checkbox' id='checkbox-parent' disabled style='vertical-align: middle;'>";
									row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-folder'></i>";
									row.insertCell(2).innerHTML = "<a href='#' onclick='get_dir(\"" + par + "\")'>../</a>";
									row.insertCell(3);
									row.insertCell(4);
								}
							}
						
							async function explorer_init() {
								bwd = pwd
							}
						</script>
					</div>
				</div>

				<div id="editor-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/editor
						</div>
						
						<div class="card border noselect" style="overflow-x: scroll; white-space: nowrap; max-width: 90%;">
							<i title="open" class='bs-ico bootstrap-folder-open ico-link-color' onclick="show_input_path_create()"></i> &nbsp;&nbsp;
							<i title="save" class='bs-ico bootstrap-save ico-link-color' onclick="save_file()"></i> &nbsp;&nbsp;
							<i title="save as" class='bs-ico bootstrap-arrow-down-square ico-link-color' onclick="show_save_as()"></i> &nbsp;&nbsp;
							<i title="goto line" class='bs-ico bootstrap-arrow-down-up ico-link-color' onclick="show_goto_line_no()"></i> &nbsp;&nbsp;
							<i title="replace" class='bs-ico bootstrap-braces-asterisk ico-link-color' onclick="show_find_and_replace()"></i> &nbsp;&nbsp;
							<i title="regex" class='bs-ico bootstrap-regex ico-link-color' onclick="show_regex_replace()"></i> &nbsp;&nbsp;
							<i title="close" class='bs-ico bootstrap-x-square ico-link-color' onclick="close_file()"></i>
						</div><br>
						
						<select id="select-highlight" class="noselect secondary-select" onchange="select_highlight_event()" style="display: inline-flex; width: 100px">
							<option value="none" disabled hidden selected>highlight</option>
							<option value="true">yes</option>
							<option value="false">no</option>
						</select><br>
						
						<div id="card-input-path" class="card" style="display: none">
							<input id="input-path" placeholder="path">
							<button class="btn" onclick="open_file()">open</button>
						</div>
						
						<div id="card-input-save-as" class="card border" style="display: none">
							<input id="input-editor-save-as-path" placeholder="path">
							<button class="btn" onclick="save_as()">save</button>
						</div>
						
						<div id="card-input-line-no" class="card border" style="display: none; width: 8em">
							<input id="input-line-no" placeholder="line" style="width: 4em">
							<button class="btn" onclick="jump_to_line()" style="display: inline">go</button>
						</div>
						
						<div id="card-input-find-replace" class="card border" style="display: none">
							<input id="input-editor-find" placeholder="find">
							<input id="input-editor-replace" placeholder="replace">
							<button class="btn" onclick="find_and_replace()">replace</button>
						</div>
						
						<div id="card-input-regex-replace" class="card border" style="display: none">
							<input id="input-editor-regex-pattern" placeholder="pattern">
							<input id="input-editor-regex-flags" placeholder="flags">
							<input id="input-editor-regex-replace" placeholder="replace">
							<button class="btn" onclick="regex_replace()">replace</button>
						</div>
						
						<select id="select-open-file" class="noselect" onchange="select_open_file_event()">
							<option value="none" disabled hidden selected>open files</option>
						</select><br>
						
						<div id="editor-container" align="center">
						<div id="editor-content" class="noselect" spellcheck="false" aria-hidden="true" onscroll="scroll_editor()"></div><textarea id="editor" class="" spellcheck="false" readonly oninput="mark_edited(); redraw_editor()" onscroll="scroll_editor_content()" onclick="set_line_no()"></textarea></div><br>
						
						<style>
							/* for block of numbers */
							.hljs-ln-numbers {
							    -webkit-touch-callout: none;
							    -webkit-user-select: none;
							    -khtml-user-select: none;
							    -moz-user-select: none;
							    -ms-user-select: none;
							    user-select: none;
						
							    text-align: center;
							    color: grey;
							    vertical-align: top;
							    border-right: 1px solid grey;
							    padding-right: 0.5em !important;
							    min-width: 2.5em !important;
						
							    /* your custom style here */
							}
						
							/* for block of code */
							.hljs-ln-code {
							    padding-left: 0.5em !important;
							}
						</style>
						
						<script>
							var open_path = "<nil>";
							const file_select = document.getElementById("select-open-file");
							const editor = document.getElementById("editor");
							var file_content = {};
						
							async function select_highlight_event() {
								highlight_editor = document.getElementById("select-highlight").value;
								document.getElementById("select-highlight").value = "none";
								redraw_editor();
							}
						
							async function select_open_file_event() {
								file_content[open_path] = editor.value;
								open_path = file_select.value;
								editor.value = file_content[open_path];
								redraw_editor();
							}
						
							async function mark_edited() {
								for(var i=0; i<file_select.length; ++i) {
									if(file_select.options[i].value == open_path) {
										if(file_select.options[i].innerHTML[file_select.options[i].innerHTML.length-1] != '*')
											file_select.options[i].innerHTML += "*";
									}
								}
							}
						
							async function editor_hide_input_cards() {
								document.getElementById("card-input-save-as").style.display = "none";
								document.getElementById("card-input-line-no").style.display = "none";
								document.getElementById("card-input-find-replace").style.display = "none";
								document.getElementById("card-input-regex-replace").style.display = "none";
								document.getElementById("card-input-path").style.display = "none";
							}
						
							async function show_save_as() {
								if(document.getElementById("card-input-save-as").style.display == "none") {
									editor_hide_input_cards();
									document.getElementById("card-input-save-as").style.display = "block";
									document.getElementById("input-editor-save-as-path").focus();
								}
								else
									editor_hide_input_cards();
							}
						
							async function show_goto_line_no() {
								if(document.getElementById("card-input-line-no").style.display == "none") {
									editor_hide_input_cards();
									document.getElementById("card-input-line-no").style.display = "block";
									document.getElementById("input-line-no").focus();
								}
								else
									editor_hide_input_cards();
							}
						
							async function show_find_and_replace() {
								if(document.getElementById("card-input-find-replace").style.display == "none") {
									editor_hide_input_cards();
									document.getElementById("card-input-find-replace").style.display = "block";
									document.getElementById("input-editor-find").focus();
								}
								else
									editor_hide_input_cards();
							}
						
							async function show_regex_replace() {
								if(document.getElementById("card-input-regex-replace").style.display == "none") {
									editor_hide_input_cards();
									document.getElementById("card-input-regex-replace").style.display = "block";
									document.getElementById("input-editor-regex-pattern").focus();
								}
								else
									editor_hide_input_cards();
							}
						
							async function show_input_path_create() {
								if(document.getElementById("card-input-path").style.display == "none") {
									await get_pwd();
						
									if(pwd.substring(0, home.length) == home)
									    pwd = "~" + pwd.substring(home.length, pwd.length);
						
									editor_hide_input_cards();
									document.getElementById("card-input-path").style.display = "block";
									document.getElementById("input-path").value = pwd + "/";
									document.getElementById("input-path").focus();
								}
								else {
									editor_hide_input_cards();
								}
							}
						
							async function open_file() {
								var path = document.getElementById("input-path").value;
						
								if(path[0] == '~' && home.length)
									path = home + path.substring(1, path.length);
						
								edit_file(path);
								document.getElementById("card-input-path").style.display = "none";
								editor.readOnly = false;
							}
						
							async function close_file() {
								delete file_content[open_path];
						
								for(var i=0; i<file_select.length; ++i) {
									if(file_select.options[i].value == open_path) {
										if(file_select.options[i].innerHTML[file_select.options[i].innerHTML.length-1] == '*') {
											if(await confirm_("save changes")) {
												save_file();
											}
										}
						
										file_select.remove(i);
						
										if(i == 1 && file_select.length == 1) {
											editor.value = "";
											editor.readOnly = true;
											file_select.value = "none";
											open_path = "<nil>"
										}
										else {
											if(i == file_select.length)
												--i;
											
											file_select.value = open_path = file_select.options[i].value;
											editor.value = file_content[open_path];
										}
										redraw_editor();
									}
								}
							}
						
							async function edit_file(path) {
								show("editor");
								editor.readOnly = false;
						
								if(open_path != "<nil>")
									file_content[open_path] = document.getElementById("editor").value;
								open_path = path;
						
								if(file_content.hasOwnProperty(open_path) && file_content[open_path] != "") {
									file_select.value = open_path;
									document.getElementById("editor").value = file_content[open_path];
									redraw_editor();
								}
								else {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("path", open_path);
						
									let response = await fetch("/api/file/read", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
									    	//"content-type": "application/x-www-form-urlencoded"
									    	"signature": signature(date)
									    },
								        body: formData
									});
									let result = await response.text();
						
									//document.getElementById("editor").value = desanitize(result);
									document.getElementById("editor").value = result;
									redraw_editor();
						
									var opt = document.createElement('option');
								    opt.value = open_path;
								    if(open_path.substring(0, home.length) == home)
									    opt.innerHTML = "~" + open_path.substring(home.length, open_path.length);
									else
									    opt.innerHTML = open_path;
								    file_select.appendChild(opt);
								    file_select.value = open_path;
								}
							}
						
							async function save_file() {
								if(open_path == "" || open_path == "<nil>") {
									alert("no file open");
									return;
								}
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", open_path);
								formData.append("content", editor.value);
						
								let response = await fetch("/api/file/write", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
								    	//"content-type": "application/x-www-form-urlencoded"
								    	"signature": signature(date)
								    },
							        body: formData
								});
								let result = await response.text();
						
								for(var i=0; i<file_select.length; ++i) {
									if(file_select.options[i].value == open_path) {
										if(file_select.options[i].innerHTML[file_select.options[i].innerHTML.length-1] == '*')
											file_select.options[i].innerHTML = file_select.options[i].innerHTML.substring(0, file_select.options[i].innerHTML.length-1);
									}
								}
							}
						
							async function save_as() {
								if(open_path == "") {
									alert("no file open");
									return;
								}
								else if(document.getElementById("input-editor-save-as-path").value == "") {
									alert("no path specified");
									return;
								}
						
								const dir = open_path.substring(0, open_path.lastIndexOf('/')+1);
								const path = document.getElementById("input-editor-save-as-path").value;
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								if(path[0] == '/' || path[0] == '~')
									formData.append("path", path);
								else
									formData.append("path", dir + path);
								formData.append("content", editor.value);
						
								let response = await fetch("/api/file/write", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
								    	//"content-type": "application/x-www-form-urlencoded"
								    	"signature": signature(date)
								    },
							        body: formData
								});
								let result = await response.text();
						
								if(path[0] == '/' || path[0] == '~')
									edit_file(path);
								else
									edit_file(dir + path);
						
								document.getElementById("card-input-save-as").style.display = "none";
							}
						
							async function editor_init() {
								if(config["editor"] && config["editor"]["highlight"] == false) {
									document.getElementById("select-highlight").value = "false";
									select_highlight_event();
								}
							}
						</script>
						
						<style>
							#select-open-file {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								min-width: 200px;
								max-width: 100%;
								width: 100%;
						
								margin: 0.5em 0;
								padding-left: 0;
						
								-ms-box-sizing:border-box;
								-moz-box-sizing:border-box;
								-webkit-box-sizing:border-box; 
								box-sizing:border-box;
							}
						
							#input-path {
								width: 400px;
								max-width: 100%;
							}
						</style>
					</div>
				</div>

				<div id="tools-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/tools
						</div>
						
						<h1 style="margin: 0.5em 0">Tools</h1>
						
						<div style="margin: 1em 0">
							<div class="card border-hover" onclick="show('certs')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-robot width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">certificates</h2>
							</div>
						
							<div class="card border-hover" onclick="show('cronjobs')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-clock width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">cronjobs</h2>
							</div>
						
							<div class="card border-hover" onclick="show('docker')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-boxes width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">docker</h2>
							</div>
						
							<div class="card border-hover" onclick="show('fail2ban')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-shield-lock width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">fail2ban</h2>
							</div>
						
							<div class="card border-hover" onclick="show('firewall')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-bricks width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">firewall</h2>
							</div>
						
							<div class="card border-hover" onclick="show('repos')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-git width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">repositories</h2>
							</div>
						
							<div class="card border-hover" onclick="show('services')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-wrench-adjustable width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">services</h2>
							</div>
						
							<div class="card border-hover" onclick="show('ssh')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-safe width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">ssh</h2>
							</div>
						
							<div class="card border-hover" onclick="show('users')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-people width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">users</h2>
							</div>
						
							<div class="card border-hover" onclick="bwd = '/var/www'; show('explorer')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-globe width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">websites</h2>
							</div>
						</div>
					</div>
				</div>

				<div id="administration-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    administration
						</div>
						
						<h1 style="margin: 0.5em 0">Administration</h1>
						
						<div style="margin: 1em 0">
							<div class="card border-hover" onclick="show('admin-dash')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-dash width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">dash</h2>
							</div>
						
							<div class="card border-hover" onclick="show('admin-system')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-server width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">system</h2>
							</div>
						</div>
					</div>
				</div>

				<div id="admin-dash-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('administration')">administration</a>/dash
						</div>
						
						<h1 style="margin: 0.5em 0">Dash</h1>
						
						<div style="margin: 1em 0">
							<div class="card border-hover" onclick="edit_file(home + '/.cloudfort/config.json')" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-gear width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">config</h2>
							</div>
						
							<div class="card border-hover" onclick="kill_dash()" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-x-square width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">kill</h2>
							</div>
						
							<div class="card border-hover" onclick="update_dash()" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-arrow-clockwise width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">update</h2>
							</div>
						</div>
						
						<script>
							async function kill_dash() {
								if(await confirm_("kill dash")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "killall cloudfort-dash");
						
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
									    	"signature": signature(date)
									    },
								        body: formData
									});
								}
							}
						
							async function update_dash() {
								if(await confirm_("update dash")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "cloudfort-dash update");
						
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
									    	"signature": signature(date)
									    },
								        body: formData
									});
									let result = await response.text();
						
									notify(result);
								}
							}
						</script>
					</div>
				</div>

				<div id="admin-system-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('administration')">administration</a>/system
						</div>
						
						<h1 style="margin: 0.5em 0">System</h1>
						
						<div style="margin: 1em 0">
							<div class="card border-hover" onclick="reboot_system()" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-arrow-repeat width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">reboot</h2>
							</div>
						
							<div class="card border-hover" onclick="update_system()" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-arrow-clockwise width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">update</h2>
							</div>
						
							<div class="card border-hover" onclick="shutdown_system()" style="cursor: pointer; width: 10em">
								<i class="bs-ico bootstrap-power width-5em card-hover-filter"></i><br>
								<hr>
								<h2 class="card-hover-color">shutdown</h2>
							</div>
						</div>
						
						<script>
						
							async function reboot_system() {
								if(await confirm_("reboot system?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "systemctl reboot");
						
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
									    	"signature": signature(date)
									    },
								        body: formData
									});
									let result = await response.text();
						
									notify(result["output"]);
								}
							}
						
							async function update_system() {
								if(await confirm_("update system?")) {
									if(pkg_man == "apk")
										await run("apk update; apk upgrade");
									else if(pkg_man == "apt" || pkg_man == "apt-get")
										await run(pkg_man + " update; DEBIAN_FRONTEND=noninteractive " + pkg_man + " -y upgrade");
									else if(pkg_man == "dnf")
										await run("dnf -y upgrade");
									else if(pkg_man == "emerge")
										await run("emaint --auto sync; emerge --oneshot sys-apps/portage; emerge --verbose --update --deep --newuse @world; emerge --depclean");
									else if(pkg_man == "pacman")
										await run("pacman --noconfirm -Syu");
									else if(pkg_man == "yum")
										await run("yum -y update");
									else if(pkg_man == "zypp")
										await run("zypp --non-interactive --auto-agree-with-licenses --no-gpg-checks up");
									else
										await notify("cannot detect package manager");
								}
							}
						
							async function shutdown_system() {
								if(await confirm_("shutdown system?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "systemctl poweroff");
						
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
									    	"signature": signature(date)
									    },
								        body: formData
									});
								}
							}
						</script>
					</div>
				</div>

				<div id="certs-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/certs
						</div>
						
						<div id="textarea-certs" spellcheck="false"></div>
						
						<button class="btn" onclick="document.getElementById('add-cert-popup').style.display = 'block'">add</button>
						<button class="btn" onclick="document.getElementById('del-cert-popup').style.display = 'block'">delete</button>
						
						<div id="add-cert-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-domain"
								type="text"
								placeholder="domain" 
							>
							<input style="margin: 0.25em 0"
								id="input-email"
								type="email"
								placeholder="email" 
							>
							<button class="btn" onclick="document.getElementById('add-cert-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="add_cert()">add</button>
						</div>
						
						<div id="del-cert-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-del-domain"
								type="text"
								placeholder="domain" 
							>
							<button class="btn" onclick="document.getElementById('del-cert-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="del_cert()">delete</button>
						</div>
						
						<script>
							const certs_ta = document.getElementById("textarea-certs");
						
							async function fetch_certs() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "sudo certbot --non-interactive certificates")
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								//certs_ta.innerHTML = result["output"];
								certs_ta.innerHTML = result.substring(result.indexOf("-"), result.lastIndexOf("-")+1);
							}
						
							async function get_host(domain) {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "dig +short " + document.getElementById("input-domain").value + " | head -n1");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								return result.substring(0, result.length-1);
							}
						
							async function get_ip() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "dig +short txt ch whoami.cloudflare @1.0.0.1")
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								return result.substring(1, result.length-2);
							}
						
							async function check_host(domain) {
								const host = await get_host(domain);
								const ip = await get_ip();
						
								if(host != ip) 
									notify_color("domain records for " + domain + " do not point towards " + ip, "var(--primary-red)");
						
								return (host == ip);
							}
						
							async function add_cert() {
								document.getElementById("add-cert-popup").style.display = "none";
						
								if(await check_host(document.getElementById("input-domain").value)) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "sudo certbot --non-interactive certonly --standalone -n --domains " + document.getElementById("input-domain").value + " --agree-tos -m " + document.getElementById("input-email").value);
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									await notify(result);
									await fetch_certs();
								}
							}
						
							async function del_cert() {
								document.getElementById("del-cert-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "certbot --non-interactive delete --cert-name " + document.getElementById("input-del-domain").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								await notify(result);
								await fetch_certs();
							}
						
							async function certs_init() {
								await fetch_certs();
							}
						</script>
						
						<style>
							#textarea-certs {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7.5em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:auto;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="cronjobs-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/cronjobs
						</div>
						
						<div id="textarea-cronjobs" spellcheck="false"></div>
						
						<button class="btn" onclick="bwd = '/var/spool/cron/crontabs'; show('explorer')">crontabs</button>
						<button class="btn" onclick="restart_cron()">restart</button>
						
						<script>
							const cronjobs_ta = document.getElementById("textarea-cronjobs");
						
							async function fetch_cronjobs() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "crontab -l");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								cronjobs_ta.innerHTML = result;
							}
						
							async function restart_cron() {
								if(await confirm_("restart cron?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "service cron restart");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
								}
							}
						
						</script>
						
						<style>
							#textarea-cronjobs {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7.5em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:auto;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="docker-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/docker
						</div>
						
						<div id="textarea-docker" spellcheck="false"></div>
						
						<div style="overflow-x: scroll; white-space: nowrap;">
						<button class="btn" onclick="bwd = '/var/lib/docker'; show('explorer')">explore</button>
						<button class="btn" onclick="fetch_docker_containers()">refresh</button>
						<button class="btn" onclick="show_run_docker_container()">run</button>
						<button class="btn" onclick="show_docker_action()">action</button>
						</div>
						
						<div id="docker-run-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-run-container-name"
								type="text"
								placeholder="container name" 
							>
							<input style="margin: 0.25em 0"
								id="input-run-docker-image"
								type="text"
								placeholder="docker image" 
							>
							<input style="margin: 0.25em 0"
								id="input-run-host-port"
								type="text"
								placeholder="host port" 
							>
							<input style="margin: 0.25em 0"
								id="input-run-container-port"
								type="text"
								placeholder="container port" 
							>
							<button class="btn" onclick="document.getElementById('docker-run-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="docker_run()">ok</button>
						</div>
						
						<div id="docker-action-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<select id="select-docker-action-type" style="margin: 0.25em 0">
								<option value="none" disabled hidden selected>action</option>
								<option value="start">start</option>
								<option value="logs">logs</option>
								<option value="top">top</option>
								<option value="pause">pause</option>
								<option value="unpause">unpause</option>
								<option value="restart">restart</option>
								<option value="stop">stop</option>
								<option value="kill">kill</option>
								<option value="rm">remove</option>
							</select>
							<input style="margin: 0.25em 0"
								id="input-container-name"
								type="text"
								placeholder="container" 
							>
							<button class="btn" onclick="document.getElementById('docker-action-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="docker_container_action()">ok</button>
						</div>
						
						<script>
							const docker_ta = document.getElementById("textarea-docker");
						
							async function show_run_docker_container() {
								document.getElementById("input-run-container-name").value = "";
								document.getElementById("input-run-docker-image").value = "";
								document.getElementById("input-run-host-port").value = "";
								document.getElementById("input-run-container-port").value = "";
								document.getElementById("docker-run-popup").style.display = "block";
							}
						
							async function show_docker_action() {
								document.getElementById("input-container-name").value = "";
								document.getElementById("docker-action-popup").style.display = "block";
							}
						
							async function fetch_docker_containers() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "docker ps -a");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								if(result.search("not found") == -1)
									docker_ta.innerHTML = result;
								else
									docker_ta.innerHTML = "Docker not installed";
							}
						
							async function docker_run() {
								document.getElementById("docker-run-popup").style.display = "none";
						
								waiting_popup("attempting to run container");
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "docker run -d -p " + document.getElementById("input-run-host-port").value + ":" + document.getElementById("input-run-container-port").value + " --name " + document.getElementById("input-run-container-name").value + " " + document.getElementById("input-run-docker-image").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								fetch_docker_containers();
						
								resolve_waiting_popup();
						
								if(result != "") {
									notify(result);
								}
							}
						
							async function docker_action(action_type) {
								document.getElementById("docker-action-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "docker " + document.getElementById("select-docker-action-type").value + " " + document.getElementById("input-container-name").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								fetch_docker_containers()
						
								if(document.getElementById("select-docker-action-type").value == "logs" || document.getElementById("select-docker-action-type").value == "top")
									mono_notify(result);
								else if(result != "") 
									notify(result);
							}
						
						</script>
						
						<style>
							#textarea-docker {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7.5em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:scroll;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre;
							}
						</style>
					</div>
				</div>

				<div id="fail2ban-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/fail2ban
						</div>
						
						<div id="textarea-fail2ban" spellcheck="false"></div>
						
						<div id="div-fail2ban-btns">
							<button id="fail2ban-ban-btn" class="btn" onclick="document.getElementById('ban-ip-popup').style.display = 'block'">ban</button>
							<button id="fail2ban-unban-btn" class="btn" onclick="document.getElementById('unban-ip-popup').style.display = 'block'">unban</button>
							<button id="fail2ban-restart-btn" class="btn" onclick="restart_fail2ban()">restart</button>
							<button class="btn" onclick="edit_file('/etc/fail2ban/jail.local')">config</button>
						</div>
						
						<div id="ban-ip-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-ban-ip"
								type="text"
								placeholder="ip" 
							>
							<button class="btn" onclick="document.getElementById('ban-ip-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="ban_ip()">ban</button>
						</div>
						
						<div id="unban-ip-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-unban-ip"
								type="text"
								placeholder="ip" 
							>
							<button class="btn" onclick="document.getElementById('unban-ip-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="unban_ip()">unban</button>
						</div>
						
						<script>
							const fail2ban_ta = document.getElementById("textarea-fail2ban");
						
							async function fetch_fail2ban_status() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "fail2ban-client status sshd");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								if(result.search("not found") == -1)
									fail2ban_ta.innerHTML = result;
								else {
									fail2ban_ta.innerHTML = "fail2ban not installed";
									document.getElementById("div-fail2ban-btns").style.display = "none";
								}
							}
						
							async function restart_fail2ban() {
								if(await confirm_("restart fail2ban?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "service fail2ban restart");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									await notify(result.replaceAll("\n", "<br>"));
									await fetch_fail2ban_status();
								}
							}
						
							async function ban_ip() {
								document.getElementById("ban-ip-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "fail2ban-client set sshd banip " + document.getElementById("input-ban-ip").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								//await notify(result.replaceAll("\n", "<br>"));
								await fetch_fail2ban_status();
							}
						
							async function unban_ip() {
								document.getElementById("unban-ip-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "fail2ban-client set sshd unbanip " + document.getElementById("input-unban-ip").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								//await notify(result.replaceAll("\n", "<br>"));
								await fetch_fail2ban_status();
							}
						</script>
						
						<style>
							#textarea-fail2ban {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7.5em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:auto;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="firewall-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/firewall
						</div>
						
						<div id="textarea-firewall" spellcheck="false"></div>
						
						<button id="firewall-add-btn" class="btn" onclick="document.getElementById('add-rule-popup').style.display = 'block'">add</button>
						<button id="firewall-del-btn" class="btn" onclick="document.getElementById('del-rule-popup').style.display = 'block'">delete</button>
						<button id="firewall-enable-btn" class="btn" onclick="enable_firewall()">enable</button>
						<button id="firewall-reset-btn" class="btn" onclick="reset_firewall()">reset</button>
						<button id="firewall-disable-btn" class="btn" onclick="disable_firewall()">disable</button>
						<button class="btn" onclick="edit_file('/etc/default/ufw')">config</button>
						
						<div id="add-rule-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<select id="select-rule-type" style="margin: 0.25em 0">
								<option value="allow" selected>allow</option>
								<option value="deny">deny</option>
							</select>
							<input style="margin: 0.25em 0"
								id="input-rule"
								type="text"
								placeholder="rule" 
							>
							<button class="btn" onclick="document.getElementById('add-rule-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="add_rule()">add</button>
						</div>
						
						<div id="del-rule-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<select id="select-del-rule-type" style="margin: 0.25em 0">
								<option value="allow" selected>allow</option>
								<option value="deny">deny</option>
							</select>
							<input style="margin: 0.25em 0"
								id="input-del-rule"
								type="text"
								placeholder="rule" 
							>
							<button class="btn" onclick="document.getElementById('del-rule-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="del_rule()">delete</button>
						</div>
						
						<script>
							const firewall_ta = document.getElementById("textarea-firewall");
						
							async function fetch_rules() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "ufw status");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								firewall_ta.innerHTML = result;
						
								document.getElementById("firewall-add-btn").style.display = "none";
								document.getElementById("firewall-del-btn").style.display = "none";
								document.getElementById("firewall-enable-btn").style.display = "none";
								document.getElementById("firewall-reset-btn").style.display = "none";
								document.getElementById("firewall-disable-btn").style.display = "none";
								if(result.search("inactive") != -1) {
									document.getElementById("firewall-enable-btn").style.display = "inline-flex";
								}
								else {
									document.getElementById("firewall-add-btn").style.display = "inline-flex";
									document.getElementById("firewall-del-btn").style.display = "inline-flex";
									document.getElementById("firewall-reset-btn").style.display = "inline-flex";
									document.getElementById("firewall-disable-btn").style.display = "inline-flex";
								}
							}
						
							async function enable_firewall() {
								if(await confirm_("enable firewall?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "ufw enable");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									await notify(result.replaceAll("\n", "<br>"));
									await fetch_rules();
								}
							}
						
							async function disable_firewall() {
								if(await confirm_("disable firewall?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "ufw disable");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									await notify(result.replaceAll("\n", "<br>"));
									await fetch_rules();
								}
							}
						
							async function reset_firewall() {
								if(await confirm_("reset firewall?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "ufw reset");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									await notify(result.replaceAll("\n", "<br>"));
									await fetch_rules();
								}
							}
						
							async function add_rule() {
								document.getElementById("add-rule-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "ufw " + document.getElementById("select-rule-type").value + " " + document.getElementById("input-rule").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								await notify(result.replaceAll("\n", "<br>"));
								await fetch_rules();
							}
						
							async function del_rule() {
								document.getElementById("del-rule-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "ufw delete " + document.getElementById("select-del-rule-type").value + " " + document.getElementById("input-del-rule").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								await notify(result.replaceAll("\n", "<br>"));
								await fetch_rules();
							}
						
							async function firewall_init() {
								await fetch_rules();
							}
						</script>
						
						<style>
							#textarea-firewall {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7.5em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:auto;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="repos-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/repositories
						</div>
						
						<h2 style="margin: 0.5em 0">Repositories</h2>
						
						<div class="card border" style="max-width: 90%; margin-bottom: 1em;">
							<table id="table-repos" style="text-align: center;">
								<tr>
									<th>org</th>
									<th>repository</th>
									<th>explore</th>
								</tr>
							</table>
						</div>
						
						<div id="div-repo-btns">
							<button class="btn" onclick="document.getElementById('add-repo-popup').style.display = 'block'">add</button>
							<button class="btn" onclick="document.getElementById('deploy-repo-popup').style.display = 'block'">deploy</button>
							<button class="btn" onclick="document.getElementById('remove-repo-popup').style.display = 'block'">remove</button>
							<button class="btn" onclick="edit_file(home + '/.cloudfort/repositories.json')">config</button>
						</div>
						
						<div id="add-repo-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-add-repo-org"
								type="text"
								placeholder="org" 
								spellcheck="false"
							>
							<input style="margin: 0.25em 0"
								id="input-add-repo-name"
								type="text"
								placeholder="repository" 
								spellcheck="false"
							>
							<input style="margin: 0.25em 0"
								id="input-add-repo-path"
								type="text"
								placeholder="path" 
								spellcheck="false"
							>
							<input style="margin: 0.25em 0"
								id="input-add-repo-deploy-script"
								type="text"
								placeholder="deploy" 
								spellcheck="false"
							>
							<button class="btn" onclick="document.getElementById('add-repo-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="add_repo()">add</button>
						</div>
						
						<div id="deploy-repo-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-deploy-repo-org"
								type="text"
								placeholder="org" 
								spellcheck="false"
							>
							<input style="margin: 0.25em 0"
								id="input-deploy-repo-name"
								type="text"
								placeholder="repository" 
								spellcheck="false"
							>
							<button class="btn" onclick="document.getElementById('deploy-repo-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="deploy_repo()">deploy</button>
						</div>
						
						<div id="remove-repo-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-remove-repo-org"
								type="text"
								placeholder="org" 
								spellcheck="false"
							>
							<input style="margin: 0.25em 0"
								id="input-remove-repo-name"
								type="text"
								placeholder="repository" 
								spellcheck="false"
							>
							<button class="btn" onclick="document.getElementById('remove-repo-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="remove_repo()">remove</button>
						</div>
						
						<script>
							const repos_table = document.getElementById("table-repos");
							var repos;
						
							async function clear_repos_table() {
								while(repos_table.rows.length > 1)
									repos_table.deleteRow(1);
							}
						
							async function fetch_repos() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", home + "/.cloudfort/repositories.json");
							
								let response = await fetch("/api/file/read", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								repos = JSON.parse(result);
						
								//alert(JSON.stringify(repos));
						
								clear_repos_table();
						
								var r = 1;
								for(const org in repos["repositories"]) {
									for(const name in repos["repositories"][org]) {
										var row = repos_table.insertRow(r++);
										row.insertCell(0).innerHTML = org;
										row.insertCell(1).innerHTML = name;
										row.insertCell(2).innerHTML = "<a onclick='bwd = \"" + repos["repositories"][org][name]["path"] + "\"; show(\"explorer\")'>explore</a>";
									}
								}
							}
						
							async function add_repo() {
								if(repos["repositories"][document.getElementById("input-add-repo-org").value] == undefined)
									repos["repositories"][document.getElementById("input-add-repo-org").value] = {};
								repos["repositories"][document.getElementById("input-add-repo-org").value][document.getElementById("input-add-repo-name").value] = {};
								repos["repositories"][document.getElementById("input-add-repo-org").value][document.getElementById("input-add-repo-name").value]["path"] = document.getElementById("input-add-repo-path").value;
								repos["repositories"][document.getElementById("input-add-repo-org").value][document.getElementById("input-add-repo-name").value]["deploy"] = document.getElementById("input-add-repo-deploy-script").value;
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", home + "/.cloudfort/repositories.json");
								formData.append("content", JSON.stringify(repos, null, "\t"));
							
								let response = await fetch("/api/file/write", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								fetch_repos();
								document.getElementById('add-repo-popup').style.display = 'none'
							}
						
							async function deploy_repo() {
								document.getElementById('input-terminal').value = "cd " + repos["repositories"][document.getElementById("input-deploy-repo-org").value][document.getElementById("input-deploy-repo-name").value]["path"];
								await run_cmd();
						
								document.getElementById('deploy-repo-popup').style.display = 'none';
								show('terminal');
						
								document.getElementById('input-terminal').value = repos["repositories"][document.getElementById("input-deploy-repo-org").value][document.getElementById("input-deploy-repo-name").value]["deploy"];
								run_cmd();
							}
						
							async function remove_repo() {
								delete repos["repositories"][document.getElementById("input-remove-repo-org").value][document.getElementById("input-remove-repo-name").value];
						
								if(Object.keys(repos["repositories"][document.getElementById("input-remove-repo-org").value]).length == 0) {
									delete repos["repositories"][document.getElementById("input-remove-repo-org").value];
								}
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("path", home + "/.cloudfort/repositories.json");
								formData.append("content", JSON.stringify(repos, null, "\t"));
							
								let response = await fetch("/api/file/write", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								fetch_repos();
								document.getElementById('remove-repo-popup').style.display = 'none'
							}
						</script>
						
						<style>
							#table-repos {
								margin: 0 auto; 
								text-align: left;
						
								display: block;
								overflow-x: scroll;
							}
						</style>
					</div>
				</div>

				<div id="services-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/services
						</div>
						
						<select id="select-service-types" onchange="fetch_services()" style="display: inline-flex; width: 100px; margin: 0.25em">
							<option value="all" selected>all</option>
							<option value="activating">activating</option>
							<option value="active">active</option>
							<option value="dead">dead</option>
							<option value="exited">exited</option>
							<option value="inactive">inactive</option>
							<option value="running">running</option>
						</select><br>
						
						<div id="textarea-services" spellcheck="false"></div>
						
						<div style="overflow-x: scroll; white-space: nowrap;">
						<button class="btn" onclick="bwd = '/etc/systemd/system'; show('explorer')">explore</button>
						<button class="btn" onclick="fetch_services()">refresh</button>
						<button class="btn" onclick="reload_services()">reload</button>
						<button class="btn" onclick="show_service_action()">action</button>
						</div>
						
						<div id="service-action-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<select id="select-service-action-type" style="margin: 0.25em 0">
								<option value="enable">enable</option>
								<option value="start">start</option>
								<option value="reload">reload</option>
								<option value="restart" selected>restart</option>
								<option value="stop">stop</option>
								<option value="disable">disable</option>
							</select>
							<input style="margin: 0.25em 0"
								id="input-service"
								type="text"
								placeholder="service" 
							>
							<button class="btn" onclick="document.getElementById('service-action-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="service_action()">ok</button>
						</div>
						
						<script>
							const services_type = document.getElementById("select-service-types");
							const services_ta = document.getElementById("textarea-services");
						
							async function show_service_action() {
								document.getElementById("input-service").value = "";
								document.getElementById("service-action-popup").style.display = "block";
							}
						
							async function fetch_services() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								if(services_type.value == "all")
									formData.append("command", "systemctl list-units --all --type=service");
								else
									formData.append("command", "systemctl list-units --all --type=service --state=" + services_type.value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								services_ta.innerHTML = result;
							}
						
							async function reload_services() {
								if(await confirm_("reload services?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "systemctl daemon-reload");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									fetch_services()
						
									if(result != "") {
										notify(result);
									}
								}
							}
						
							async function service_action(action_type) {
								document.getElementById("service-action-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "systemctl " + document.getElementById("select-service-action-type").value + " " + document.getElementById("input-service").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								fetch_services()
						
								if(result != "") 
									notify(result);
							}
						
						</script>
						
						<style>
							#textarea-services {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 10em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:scroll;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre;
							}
						</style>
					</div>
				</div>

				<div id="ssh-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/ssh
						</div>
						
						<h1 style="margin: 0.5em 0">SSH</h1>
						
						<div class="card border-hover" onclick="edit_file('~/.ssh/authorized_keys')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-key width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">keys</h2>
						</div>
						
						<div class="card border-hover" onclick="edit_file('/etc/ssh/sshd_config')" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-gear width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">config</h2>
						</div>
						
						<div class="card border-hover" onclick="reset_ssh()" style="cursor: pointer; width: 10em">
							<i class="bs-ico bootstrap-arrow-repeat width-5em card-hover-filter"></i><br>
							<hr>
							<h2 class="card-hover-color">reload</h2>
						</div>
						
						<script>
							async function reset_ssh() {
								if(await confirm_("reload ssh?")) {
									const date = new Date().getTime().toString();
									const formData = new FormData();
									formData.append("date", date);
									formData.append("command", "/etc/init.d/ssh reload");
								
									let response = await fetch("/api/run", {
										method: "POST",
										headers: {
											//"content-type": "application/json"
											"signature": signature(date)
									    },
										body: formData
									});
									let result = await response.text();
						
									notify(result.replaceAll("\n", "<br>"));
								}
							}
						</script>
					</div>
				</div>

				<div id="users-div" class="main-div" style="display: none">
					<div class="main-page">
						<div id="dash-breadcrumb">
						    <a onclick="show('index')">dash</a>/<a onclick="show('tools')">tools</a>/users
						</div>
						
						<div id="textarea-users" spellcheck="false"></div>
						
						<div>
							<button class="btn" onclick="document.getElementById('add-user-popup').style.display = 'block'">add</button>
							<button class="btn" onclick="document.getElementById('modify-user-popup').style.display = 'block'">modify</button>
							<button class="btn" onclick="document.getElementById('delete-user-popup').style.display = 'block'">delete</button>
						</div>
						
						<div id="add-user-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-add-user-username"
								type="text"
								placeholder="username" 
							>
							<button class="btn" onclick="document.getElementById('add-user-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="add_user()">add</button>
						</div>
						
						<div id="modify-user-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-modify-user-current-username"
								type="text"
								placeholder="current username" 
							>
							<input style="margin: 0.25em 0"
								id="input-modify-user-new-username"
								type="text"
								placeholder="new username" 
							>
							<button class="btn" onclick="document.getElementById('modify-user-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="modify_user()">modify</button>
						</div>
						
						<div id="delete-user-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
							<input style="margin: 0.25em 0"
								id="input-delete-user-username"
								type="text"
								placeholder="username" 
							>
							<select id="select-remove-home" style="margin: 0.25em 0">
								<option value="none" hidden disabled selected>remove home</option>
								<option value="true">yes</option>
								<option value="false">no</option>
							</select>
							<button class="btn" onclick="document.getElementById('delete-user-popup').style.display = 'none'">cancel</button>
							<button class="btn" onclick="delete_user()">delete</button>
						</div>
						
						<script>
							const users_ta = document.getElementById("textarea-users");
						
							async function fetch_users() {
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "cat /etc/passwd | grep -vE '(/bin/false|/sbin/nologin|/bin/sync)' | cut -d: -f1");
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
						
								users_ta.innerHTML = "Users:\n" + result;
							}
						
							async function add_user() {
								document.getElementById("add-user-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "useradd " + document.getElementById("input-add-user-username").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								document.getElementById("input-add-user-username").value = "";
								await fetch_users();
								//await notify(result.replaceAll("\n", "<br>"));
							}
						
							async function modify_user() {
								document.getElementById("modify-user-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								formData.append("command", "usermod -l " + document.getElementById("input-modify-user-new-username").value + " " + document.getElementById("input-modify-user-current-username").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								document.getElementById("input-modify-user-current-username").value = "";
								document.getElementById("input-modify-user-new-username").value = "";
								await fetch_users();
								//await notify(result.replaceAll("\n", "<br>"));
							}
						
							async function delete_user() {
								document.getElementById("delete-user-popup").style.display = "none";
						
								const date = new Date().getTime().toString();
								const formData = new FormData();
								formData.append("date", date);
								if(document.getElementById("select-remove-home").value == "true")
									formData.append("command", "deluser --remove-home " + document.getElementById("input-delete-user-username").value);
								else
									formData.append("command", "deluser " + document.getElementById("input-delete-user-username").value);
							
								let response = await fetch("/api/run", {
									method: "POST",
									headers: {
										//"content-type": "application/json"
										"signature": signature(date)
								    },
									body: formData
								});
								let result = await response.text();
								
								document.getElementById("input-delete-user-username").value = "";
								await fetch_users();
								await notify(result.replaceAll("\n", "<br>"));
							}
						</script>
						
						<style>
							#textarea-users {
								background: var(--secondary-dark);
								border: 1px solid var(--light-black);
								color: var(--white);
								height: calc(100vh - 7.5em); 
								width: 100%;
								font-family: "ubuntu mono";
								font-size: 0.9em;
								overflow-x:auto;
								padding: 0.25em 0.25em;
								margin: 0.25em 0;
								resize: none;
								text-align: left;
								white-space: pre-wrap;
							}
						</style>
					</div>
				</div>

				<div id="tos-div" class="main-div" style="display: none">
					<div class="main-page">
						<h2>Terms of Service</h2>
						
						<p><span class="website_name">Cloudfort</span> ("Us" or "We") provides the <span class="website_url">https://cloudfort.app</span> website and various related services (collectively, the "Website") to you, the User, subject to your compliance with all the terms, conditions, and notices contained or referenced herein (the "Terms of Service"), as well as any other written agreement between us and you.</p>
						
						<p>In addition, when using particular services or materials on this Website, Users shall be subject to any posted rules applicable to such services or materials that may contain terms and conditions in addition to those in these Terms of Service. All such guidelines or rules are hereby incorporated by reference into these Terms of Service.</p>
						
						<p>These Terms of Service are effective as of <span class="date">[DATE]</span>. We expressly reserve the right to change these Terms of Service from time to time without notice to you. You acknowledge and agree that it is your responsibility to review this Website and these Terms of Service from time to time and to familiarize yourself with any modifications.</p>
						
						<p>Your continued use of this Website after such modifications will constitute acknowledgement of the modified Terms of Service and agreement to abide and be bound by the modified Terms of Service.</p>
						
						<p>We reserve the sole right to either modify or discontinue the Website, including any of the Website’s features, at any time with or without notice to you. We will not be liable to you or any third party should we exercise such right. Any new features that augment or enhance the then-current services on this Website shall also be subject to these Terms of Service.</p>
						
						<h3>Conduct on Website</h3>
						
						<p>Your use of the Website is subject to all applicable laws and regulations, and you are solely responsible for the substance of your communications through the Website. By posting information in or otherwise using any communications service, chat room, message board, newsgroup, software library, or other interactive service that may be available to you on or through this Website, you agree that you will not upload, share, post, or otherwise distribute or facilitate distribution of any content — including text, communications, software, images, sounds, data, or other information — that:</p>
						
						<ul>
						<li>Is unlawful, threatening, abusive, harassing, defamatory, libelous, deceptive, fraudulent, invasive of another's privacy, tortious, contains explicit or graphic descriptions or accounts of sexual acts (including but not limited to sexual language of a violent or threatening nature directed at another individual or group of individuals), or otherwise violates our rules or policies</li>
						<li>Victimizes, harasses, degrades, or intimidates an individual or group of individuals on the basis of religion, gender, sexual orientation, race, ethnicity, age, or disability</li>
						<li>Infringes on any patent, trademark, trade secret, copyright, right of publicity, or other proprietary right of any party</li>
						<li>Constitutes unauthorized or unsolicited advertising, junk or bulk email (also known as "spamming"), chain letters, any other form of unauthorized solicitation, or any form of lottery or gambling</li>
						<li>Contains software viruses or any other computer code, files, or programs that are designed or intended to disrupt, damage, or limit the functioning of any software, hardware, or telecommunications equipment or to damage or obtain unauthorized access to any data or other information of any third party</li>
						<li>Impersonates any person or entity, including any of our employees or representatives</li>
						</ul>
						
						<p>We neither endorse nor assume any liability for the contents of any material uploaded or submitted by third party users of the Website. We generally do not pre-screen, monitor, or edit the content posted by users of communications services, chat rooms, message boards, newsgroups, software libraries, or other interactive services that may be available on or through this Website. However, we and our agents have the right at their sole discretion to remove any content that, in our judgment, does not comply with these Terms of Service and any other rules of user conduct for our site, or is otherwise harmful, objectionable, or inaccurate. We are not responsible for any failure or delay in removing such content. You hereby consent to such removal and waive any claim against us arising out of such removal of content.</p>
						
						<p>You agree that we may at any time, and at our sole discretion, terminate your membership, account, or other affiliation with our site without prior notice to you for violating any of the above provisions. In addition, you acknowledge that we will cooperate fully with investigations of violations of systems or network security at other sites, including cooperating with law enforcement authorities in investigating suspected criminal violations.</p>
						
						<h3>Third Party Websites</h3>
						
						<p>This site may link you to other sites on the Internet or otherwise include references to information, documents, software, materials and/or services provided by other parties. These sites may contain information or material that some people may find inappropriate or offensive.</p>
						
						<p>These other sites and parties are not under our control, and you acknowledge that we are not responsible for the accuracy, copyright compliance, legality, decency, or any other aspect of the content of such sites, nor are we responsible for errors or omissions in any references to other parties or their products and services. The inclusion of such a link or reference is provided merely as a convenience and does not imply endorsement of, or association with, the Website or party by us, or any warranty of any kind, either express or implied.</p>
						
						<h3>Intellectual Property</h3>
						
						<p>All custom graphics, icons, logos, and service names used on the Website are registered trademarks, service marks, and/or artwork held under copyright of <span class="website_name">Cloudfort</span> or its Affiliates. All other marks are property of their respective owners. Nothing in these Terms of Service grants you any right to use any trademark, service mark, logo, and/or the name or trade names of <span class="website_name">Cloudfort</span> or its Affiliates.</p>
						
						<h3>Disclaimer of Warranties</h3>
						
						<p>Content available through this Website often represents the opinions and judgments of an information provider, site user, or other person or entity not connected with us. We do not endorse, nor are we responsible for the accuracy or reliability of, any opinion, advice, or statement made by anyone other than an authorized <span class="website_name">Cloudfort</span> spokesperson speaking in his/her official capacity. Please refer to the specific editorial policies posted on various sections of this Website for further information, which policies are incorporated by reference into these Terms of Service.</p>
						
						<p>You understand and agree that temporary interruptions of the services available through this Website may occur as normal events. You further understand and agree that we have no control over third party networks you may access in the course of the use of this Website, and therefore, delays and disruption of other network transmissions are completely beyond our control.</p>
						
						<p>You understand and agree that the services available on this Website are provided "AS IS" and that we assume no responsibility for the timeliness, deletion, mis-delivery or failure to store any user communications or personalization settings.</p>
						
						<h3>International Use</h3>
						
						<p>Although this Website may be accessible worldwide, we make no representation that materials on this Website are appropriate or available for use in locations outside the United States, and accessing them from territories where their contents are illegal is prohibited. Those who choose to access this Website from other locations do so on their own initiative and are responsible for compliance with local laws. Any offer for any product, service, and/or information made in connection with this Website is void where prohibited.</p>
						
						<h3>Termination</h3>
						
						<p>You agree that we may, in our sole discretion, terminate or suspend your access to all or part of the Website with or without notice and for any reason, including, without limitation, breach of these Terms of Service. Any suspected fraudulent, abusive or illegal activity may be grounds for terminating your relationship and may be referred to appropriate law enforcement authorities.</p>
						
						<p>Upon termination or suspension, regardless of the reasons therefore, your right to use the services available on this Website immediately ceases, and you acknowledge and agree that we may immediately deactivate or delete your account and all related information and files in your account and/or bar any further access to such files or this Website. We shall not be liable to you or any third party for any claims or damages arising out of any termination or suspension or any other actions taken by us in connection with such termination or suspension.</p>
						    
						<h3>Governing Law</h3>
						
						<p>These Terms of Service and any dispute or claim arising out of, or related to them, shall be governed by and construed in accordance with the internal laws of the <span class="country">au</span> without giving effect to any choice or conflict of law provision or rule.</p>
						
						<p>Any legal suit, action or proceeding arising out of, or related to, these Terms of Service or the Website shall be instituted exclusively in the federal courts of <span class="country">au</span>.</p>
					</div>
				</div>

				<div id="privacy-policy-div" class="main-div" style="display: none">
					<div class="main-page">
						<h2>Privacy Policy</h2>
						
						<p>At <span class="website_name">Cloudfort</span>, we collect and manage user data according to the following Privacy Policy.</p>
						
						<h3>Data Collected</h3>
						
						<p>We collect information you provide directly to us. For example, we collect information when you create an account, subscribe, participate in any interactive features of our services, fill out a form, request customer support or otherwise communicate with us. The types of information we may collect include your name, email address, postal address, credit card information and other contact or identifying information you choose to provide.</p>
						
						<p>We collect anonymous data from every visitor of the Website to monitor traffic and fix bugs. For example, we collect information like web requests, the data sent in response to such requests, the Internet Protocol address, the browser type, the browser language, and a timestamp for the request.</p>
						
						<p>We also use various technologies to collect information, and this may include sending cookies to your computer. Cookies are small data files stored on your hard drive or in your device memory that helps us to improve our services and your experience, see which areas and features of our services are popular and count visits. We may also collect information using web beacons (also known as "tracking pixels"). Web beacons are electronic images that may be used in our services or emails and to track count visits or understand usage and campaign effectiveness.</p>
						
						<h3>Use of the Data</h3>
						
						<p>We only use your personal information to provide you the <span class="website_name">Cloudfort</span> services or to communicate with you about the Website or the services.</p>
						
						<p>We employ industry standard techniques to protect against unauthorized access of data about you that we store, including personal information.</p>
						
						<p>We do not share personal information you have provided to us without your consent, unless:</p>
						
						<ul>
						<li>Doing so is appropriate to carry out your own request</li>
						<li>We believe it's needed to enforce our legal agreements or that is legally required</li>
						<li>We believe it's needed to detect, prevent or address fraud, security or technical issues</li>
						</ul>
						
						<h3>Sharing of Data</h3>
						
						<p>We don't share your personal information with third parties. Aggregated, anonymized data is periodically transmitted to external services to help us improve the Website and service.</p>
						
						<p>We may allow third parties to provide analytics services. These third parties may use cookies, web beacons and other technologies to collect information about your use of the services and other websites, including your IP address, web browser, pages viewed, time spent on pages, links clicked and conversion information.</p>
						
						<p>We also use social buttons provided by services like Twitter, Google+, LinkedIn and Facebook. Your use of these third party services is entirely optional. We are not responsible for the privacy policies and/or practices of these third party services, and you are responsible for reading and understanding those third party services' privacy policies.</p>
						
						<h3>Cookies</h3>
						
						<p>We may use cookies on our site to remember your preferences.</p>
						
						<h3>Opt-Out, Communication Preferences</h3>
						
						<p>You may modify your communication preferences and/or opt-out from specific communications at any time. Please specify and adjust your preferences.</p>
						
						<h3>Security</h3>
						
						<p>We take reasonable steps to protect personally identifiable information from loss, misuse, and unauthorized access, disclosure, alteration, or destruction. But, you should keep in mind that no Internet transmission is ever completely secure or error-free. In particular, email sent to or from the Sites may not be secure.</p>
						
						<h3>About Children</h3>
						
						<p>The Website is not intended for children under the age of 13. We do not knowingly collect personally identifiable information via the Website from visitors in this age group.</p>
						
						<h3>Changes to the Privacy Policy</h3>
						
						<p>We may amend this Privacy Policy from time to time. Use of information we collect now is subject to the Privacy Policy in effect at the time such information is used.</p>
						
						<p>If we make major changes in the way we collect or use information, we will notify you by posting an announcement on the Website or sending you an email.</p><h1>Dashboard</h1>
					</div>
				</div>

				</div>
		</div>

		<style>
			#menu-bars {
			  	display: none;
			}

			#menu-div {
			  padding: 1em 0;
			  background: var(--secondary-dark);
			  text-align: center;
			  width: 3.5em;
			  height: 100vh;
			  display: inline-flex;
			  position: fixed;
			  top: 0;
			  left: 0;

			  overflow-y: auto;

			  z-index: 5;

			  box-shadow: 0 0.1rem 0.7rem rgb(0 0 0 / 20%) !important;
			}

			#banner-div {
			  padding: 1em;
			  background: var(--secondary-dark);
			  width: 100%;
			  height: 3.5em;
			  display: inline-flex;
			  position: absolute;
			  top: 0;
			  left: 0;

			  box-shadow: 0 0.1rem 0 rgb(0 0 0 / 20%) !important;
			}

			.main-div {
			  padding-top: 3.75em;
			  margin-left: 3.5em;
			  width: calc(100% - 3.5em);
			  min-height: calc(100vh - 2.5em);
			}

			.main-page {
			  max-width: calc(100% - 3.5em);
			  /*text-align: left;*/
			}

			#footer-div {
			  background: var(--primary-dark);
			  padding: 0.7em;
			  margin-left: 3.5em;
			  width: calc(100% - 3.5em);
			  height: 2.5em;
			  display: inline-flex;

			  border-top: 1px solid var(--light-black);
			  box-shadow: 0 0.1rem 0.5em rgb(0 0 0 / 20%) !important;
			}

			@media screen and (max-width: 600px) {
			  #h2-Cloudfort {
			  	display: none;
			  }

			  #menu-bars {
			  	display: block;
			  }

			  #menu-div {
			    display: none;
			  }

			  #footer-div {
			    margin-left: 0;
			    width: 100%;
			  }

			  .main-div {
			    margin-left: 0;
			    width: 100%;
			  }

			  .main-page {
			    max-width: 90%;
			  }
			}
		</style>

		<script type="text/javascript" src="assets/js/script.js"></script>
		<script type="text/javascript" src="assets/js/menu.js"></script>

		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
		<script type="text/javascript" src="assets/js/mantis-editor.js"></script>

		<script src="assets/js/crypto-js/crypto-js.js"></script>

		<script>
			var home = "nil";
			var pwd = "~/";
			var pkg_man;
			var config;

			const CLOUDFORT_DASH_PW = localStorage.getItem("CLOUDFORT_DASH_PW");
			function signature(msg) {
				return CryptoJS.HmacSHA256(msg, CLOUDFORT_DASH_PW)
			}

			var x = document.getElementsByName("cyear");
			for(var i=0; i<x.length; i++)
				x[i].innerHTML = new Date().getFullYear();

			function show(name) {
				if(name == "index") {
					document.title = "Dash";
				}
				else
					document.title = "Dash - " + name;

				document.getElementById("index-div").style.display = "none";
				document.getElementById("monitor-div").style.display = "none";
				document.getElementById("terminal-div").style.display = "none";
				document.getElementById("explorer-div").style.display = "none";
				document.getElementById("editor-div").style.display = "none";
				document.getElementById("tools-div").style.display = "none";
				document.getElementById("administration-div").style.display = "none";
				document.getElementById("admin-dash-div").style.display = "none";
				document.getElementById("admin-system-div").style.display = "none";
				document.getElementById("certs-div").style.display = "none";
				document.getElementById("cronjobs-div").style.display = "none";
				document.getElementById("docker-div").style.display = "none";
				document.getElementById("fail2ban-div").style.display = "none";
				document.getElementById("firewall-div").style.display = "none";
				document.getElementById("repos-div").style.display = "none";
				document.getElementById("services-div").style.display = "none";
				document.getElementById("ssh-div").style.display = "none";
				document.getElementById("users-div").style.display = "none";

				document.getElementById(name + "-div").style.display = "block";

				if(name == "cronjobs")
					fetch_cronjobs();
				else if(name == "docker")
					fetch_docker_containers();
				else if(name == "fail2ban")
					fetch_fail2ban_status();
				else if(name == "repos")
					fetch_repos();
				else if(name == "services")
					fetch_services();
				else if(name == "users")
					fetch_users();
				else if(name == "explorer")
					get_dir(bwd);
				else if(name == "monitor")
					fetch_top();
				else if(name == "terminal")
					document.getElementById("input-terminal").focus();
			}

			async function sign_out() {
			    localStorage.removeItem("CLOUDFORT_DASH_PW")
			    window.location.href = "auth/sign-in/"
			}

			async function check_signed_in() {
				if(!localStorage.getItem("CLOUDFORT_DASH_PW"))
					window.location.href = "auth/sign-in/"

				const date = new Date().getTime().toString();

				const formData = new FormData();
				formData.append("date", date);

				let response = await fetch("/api/sigcheck", {
					method: "POST",
					headers: {
						//"content-type": "application/json"
						"signature": signature(date)
				    },
			        body: formData
				});
				let result = await response.text();

				if(result != "true") {
					window.location.href = "auth/sign-in/"
				}
			}

			function desanitize(str) {
			    str = str.replaceAll("\\n", "\n");
			    str = str.replaceAll("\\t", "\t");
			    str = str.replaceAll("\\\"", "\"");

				//var re = /\n.*\\r/g
				//str = str.replaceAll(re, "\n");

				//while(str.indexOf("\\b") != -1)
			      //  str = str.replace(/.\\b/, "");

			    return str;
			}

			async function get_config() {
				const date = new Date().getTime().toString();

				const formData = new FormData();
				formData.append("date", date);
				formData.append("path", home + "/.cloudfort/config.json");

				let response = await fetch("/api/file/read", {
					method: "POST",
					headers: {
						//"content-type": "application/json"
						"signature": signature(date)
				    },
			        body: formData
				});
				config = JSON.parse(await response.text());
			}

			async function get_home() {
				const date = new Date().getTime().toString();

				const formData = new FormData();
				formData.append("date", date);

				let response = await fetch("/api/home", {
					method: "POST",
					headers: {
						//"content-type": "application/json"
						"signature": signature(date)
				    },
			        body: formData
				});
				home = await response.text();
			}

			async function get_pkg_man() {
				const date = new Date().getTime().toString();

				const formData = new FormData();
				formData.append("date", date);

				let response = await fetch("/api/pkg-man", {
					method: "POST",
					headers: {
						//"content-type": "application/json"
						"signature": signature(date)
				    },
			        body: formData
				});
				pkg_man = await response.text();
			}

			async function get_pwd() {
				const date = new Date().getTime().toString();

				const formData = new FormData();
				formData.append("date", date);

				let response = await fetch("/api/pwd", {
					method: "POST",
					headers: {
						//"content-type": "application/json"
						"signature": signature(date)
				    },
			        body: formData
				});
				pwd = await response.text();
			}

			async function dash_init() {
				await check_signed_in();

				//resolve_waiting_popup();
				//document.getElementById("content").style.display = "block";

				await get_home();
				await get_config();
				await get_pkg_man();
				await get_pwd();

				await editor_init();
				await explorer_init();
				await monitor_init();
				await terminal_init();
				await certs_init();
				await firewall_init();

				resolve_waiting_popup();
				document.getElementById("content").style.display = "block";
			}
			dash_init();

			document.body.onkeydown = function(e) {
				if(e.altKey) {
					if(e.key == 'e') {
						e.preventDefault();
						show('editor');
					}
					else if(e.key == 'm') {
						e.preventDefault();
						show('monitor');
					}
					else if(e.key == 't') {
						e.preventDefault();
						show('terminal');
					}
					else if(e.key == 'x') {
						e.preventDefault();
						show('explorer')
					}
					else if(e.key == "f" || e.key == "Enter") {
						e.preventDefault();
						if(document.fullscreenElement || document.webkitIsFullScreen || document.mozFullScreen || document.msIsFullScreen) {
							document.exitFullscreen();
						}
						else {
							if(document.getElementById("html").requestFullscreen)
								document.getElementById("html").requestFullscreen();
							else if(document.getElementById("html").webkitRequestFullscreen)
								document.getElementById("html").webkitRequestFullscreen();
							else if(document.getElementById("html").mozRequestFullscreen)
								document.getElementById("html").mozRequestFullscreen();
							else if(document.getElementById("html").msRequestFullscreen)
								document.getElementById("html").msRequestFullscreen();
						}
					}
				}
				else if(e.ctrlKey) {
					/*if(e.key == "r") {
						e.preventDefault();
					}*/
				}
				else if(e.key == 'ArrowRight' || e.code == 'ArrowRight') {
					if(document.getElementById("serve-img-popup").style.display == "block") {
						e.preventDefault();
						serve_image_increment();
					}
					else if(document.getElementById("serve-video-popup").style.display == "block") {
						e.preventDefault();
						serve_video_increment();
					}
				}
				else if(e.key == 'ArrowLeft' || e.code == 'ArrowLeft') {
					if(document.getElementById("serve-img-popup").style.display == "block") {
						e.preventDefault();
						serve_image_decrement();
					}
					else if(document.getElementById("serve-video-popup").style.display == "block") {
						e.preventDefault();
						serve_video_decrement();
					}
				}
			}
		</script>
	</body>
</html>
