<div id="dash-breadcrumb">
    <a onclick="show('index')">dash</a>/explorer
</div>

<div class="card border">
	<span id="span-pwd"></span>
</div><br>

<div class="card border noselect" style="overflow-x: scroll; white-space: nowrap; max-width: 90%;">
	<i title="home" class='bs-ico bootstrap-house ico-link-color' onclick="get_dir(home)"></i> &nbsp;&nbsp;
	<i title="refresh" class='bs-ico bootstrap-arrow-repeat ico-link-color' onclick="get_dir(bwd)"></i> &nbsp;&nbsp;
	<i title="new directory" class='bs-ico bootstrap-folder-plus ico-link-color' onclick="show_create_dir()"></i> &nbsp;&nbsp;
	<i title="new file" class='bs-ico bootstrap-file-earmark-plus ico-link-color' onclick="show_create_file()"></i> &nbsp;&nbsp;
	<i title="edit" class='bs-ico bootstrap-code-square ico-link-color' onclick="edit_selected_files()"></i> &nbsp;&nbsp;
	<i title="open in terminal" class='bs-ico bootstrap-terminal ico-link-color' onclick="open_in_terminal()"></i> &nbsp;&nbsp;
	<i title="run" class='bs-ico bootstrap-alt ico-link-color' onclick="show_run_cmd()"></i> &nbsp;&nbsp;
	<i title="compress" class='bs-ico bootstrap-box ico-link-color' onclick="show_compress_file()"></i> &nbsp;&nbsp;
	<i title="extract" class='bs-ico bootstrap-file-zip ico-link-color' onclick="extract_paths()"></i> &nbsp;&nbsp;
	<i title="upload" class='bs-ico bootstrap-cloud-arrow-up ico-link-color' onclick="show_upload_file()"></i> &nbsp;&nbsp;
	<i title="url" class='bs-ico bootstrap-cloud-arrow-down ico-link-color' onclick="show_fetch_url()"></i> &nbsp;&nbsp;
	<i title="download" class='bs-ico bootstrap-download ico-link-color' onclick="download_files()"></i> &nbsp;&nbsp;
	<i title="copy/move" class='bs-ico bootstrap-box-arrow-right ico-link-color' onclick="show_mv_paths()"></i> &nbsp;&nbsp;
	<i title="rename" class='bs-ico bootstrap-input-cursor-text ico-link-color' onclick="show_rename_path()"></i> &nbsp;&nbsp;
	<i title="delete" class='bs-ico bootstrap-trash ico-link-color' onclick="rm_paths()"></i>
</div><br>


<div id="download-popup" class="card card-shadow-no-hover popup popup-dash popup-middle" style="width: 400px">
	<table id="table-downloads">
	</table><br>

	<button class="btn" onclick="document.getElementById('download-popup').style.display = 'none'" style="width: 100px; margin: 0 auto">close</button>
</div>

<div id="card-fetch-url" class="card border" style="display: none">
	<input id="input-fetch-url" placeholder="url" style="width: 300px; max-width: 90%;">
	<button class="btn" onclick="fetch_url()">fetch</button>
</div>

<div id="card-run-cmd" class="card border" style="display: none">
	<input id="input-explorer-cmd" placeholder="cmd" style="width: 400px; max-width: 90%">
	<button class="btn" onclick="explorer_run_cmd()">run</button>
</div>

<div id="card-input-name" class="card border" style="display: none">
	<input id="input-name" placeholder="name">
	<button id="create_dir_button"  class="btn" onclick="create_dir()" style="display: none">create</button>
	<button id="create_file_button" class="btn" onclick="create_file()" style="display: none">create</button>
</div>

<div id="card-input-compress" class="card border" style="display: none">
	<input id="input-name-compress" placeholder="name" style="width:200px">
	<select id="select-compress" style="margin: 0.25em; width: 75px">
		<option value=".tar.xz" selected>.tar.xz</option>
		<option value=".tar.gz">.tar.gz</option>
		<option value=".tar.bz2">.tar.bz2</option>
		<option value=".zip">.zip</option>
	</select>
	<button  class="btn" onclick="compress_paths()">compress</button>
</div>

<div id="card-input-upload" class="card border" style="display: none">
	<div class="dropzone">
		<div id="span-dropzone" style="padding: 0.25em 0; overflow-x: hidden; white-space: nowrap; font-size: 1em">drop or select</div>
		<input id="input-file" type="file" class="upload-input" onchange="display_filename()" />
	</div>
	<button id="upload_button"  class="btn" onclick="upload_file()">upload</button>
</div>

<div id="card-input-rename" class="card border" style="display: none">
	<input id="input-name-current" placeholder="current path" style="width: 300px"><br>
	<input id="input-name-new" placeholder="new path" style="width: 300px"><br>
	<button id="duplicate_path_button"  class="btn" onclick="duplicate_path()">duplicate</button>
	<button id="rename_path_button"  class="btn" onclick="rename_path()">rename</button>
</div>

<div id="card-input-mv" class="card border" style="display: none">
	<input id="input-mv-path" placeholder="path">
	<button  class="btn" onclick="cp_paths()">copy</button>
	<button  class="btn" onclick="mv_paths()">move</button>
</div>

<div class="card border" id="card-browser" style="max-width: 90%; margin-bottom: 1em;">
	<table id="table-files">
		<tr>
			<th><input type='checkbox' id='checkbox-all' onchange='select_all_event()' style='vertical-align: middle;'></th>
			<th></th>
			<th style="margin-right:100px">name</th>
			<th>size</th>
			<th>modified</th>
		</tr>
	</table>
</div>

<style>
	input[type=checkbox] {
		position: relative;
		cursor: pointer;
    }
    input[type=checkbox]:before {
		content: "";
		display: block;
		position: absolute;
		width: 12px;
		height: 12px;
		top: 0;
		left: 2px;
		border: 1px solid grey;
		border-radius: 4px;
		background-color: var(--secondary-dark);
	}
    input[type=checkbox]:checked:after {
		content: "";
		display: block;
		width: 3px;
		height: 8px;
		border: solid white;
		border-width: 0 2px 2px 0;
		-webkit-transform: rotate(45deg);
		-ms-transform: rotate(45deg);
		transform: rotate(45deg);
		position: absolute;
		top: 0px;
		left: 6px;
	}

	.dropzone {
		margin-top: 0.15em;
		width: 300px;
		height: 30px;
		border: 1px dashed #999;
		border-radius: 3px;
		text-align: center;
	}

	.upload-icon {
		vertical-align: middle;
	}

	.upload-input {
		cursor: pointer;
		position: relative;
		top: -28px;
		left: 0;
		width: 100%;
		height: 30px;
		opacity: 0;
	}

	#table-files, #table-downloads {
		margin: 0 auto; 
		text-align: left;

		display: block;
		overflow-x: scroll;
		/*height: calc(100vh - 16em);
		overflow-y: scroll;*/
	}

	#card-browser {
		/*height: calc(100vh - 15em);*/
	}
</style>

<script>
	const files_table = document.getElementById("table-files");
	var bwd = "nil"; //browser working directory
	var explorer_files;

	async function select_all_event() {
		//document.getElementById('checkbox-parent').checked = document.getElementById('checkbox-all').checked;
		for(var f=0; f<explorer_files.length; ++f) {
			document.getElementById('checkbox-' + f).checked = document.getElementById('checkbox-all').checked;
		}
	}

	async function hide_input_cards() {
		document.getElementById("card-fetch-url").style.display = "none";
		document.getElementById("card-run-cmd").style.display = "none";
		document.getElementById("card-input-upload").style.display = "none";
		document.getElementById("card-input-mv").style.display = "none";
		document.getElementById("card-input-rename").style.display = "none";
		document.getElementById("card-input-name").style.display = "none";
		document.getElementById("card-input-compress").style.display = "none";
		document.getElementById("create_dir_button").style.display = "none";
		document.getElementById("create_file_button").style.display = "none";
	}

	async function show_fetch_url() {
		if(document.getElementById("card-fetch-url").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-fetch-url").style.display = "block";
			document.getElementById("input-fetch-url").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function show_run_cmd() {
		if(document.getElementById("card-run-cmd").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-run-cmd").style.display = "block";
			document.getElementById("input-explorer-cmd").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function show_create_dir() {
		if(document.getElementById("create_dir_button").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-input-name").style.display = "block";
			document.getElementById("create_dir_button").style.display = "inline-flex";
			document.getElementById("input-name").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function show_create_file() {
		if(document.getElementById("create_file_button").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-input-name").style.display = "block";
			document.getElementById("create_file_button").style.display = "inline-flex";
			document.getElementById("input-name").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function show_compress_file() {
		if(document.getElementById("card-input-compress").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-input-compress").style.display = "block";
			document.getElementById("input-name-compress").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function show_upload_file() {
		if(document.getElementById("card-input-upload").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-input-upload").style.display = "block";
		}
		else {
			hide_input_cards();
		}
	}

	async function display_filename() {
		document.getElementById("span-dropzone").innerHTML = document.getElementById("input-file").value.split('\\').pop();
	}

	async function show_rename_path() {
		if(document.getElementById("card-input-rename").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-input-rename").style.display = "block";
			document.getElementById("input-name-current").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function show_mv_paths() {
		if(document.getElementById("card-input-mv").style.display == "none") {
			hide_input_cards();
			document.getElementById("card-input-mv").style.display = "block";
			document.getElementById("input-mv-path").focus();
		}
		else {
			hide_input_cards();
		}
	}

	async function create_dir() {
		var dirname = document.getElementById("input-name").value;

		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		formData.append("path", bwd + "/" + dirname);

		response = await fetch("/api/dir/create", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		get_dir(bwd);

		document.getElementById("input-name").value = "";
		document.getElementById("card-input-name").style.display = "none";
		document.getElementById("create_dir_button").style.display = "none";
	}

	async function create_file() {
		var filename = document.getElementById("input-name").value;

		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		formData.append("path", bwd + "/" + filename);

		response = await fetch("/api/file/create", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		get_dir(bwd);

		document.getElementById("input-name").value = "";
		document.getElementById("card-input-name").style.display = "none";
		document.getElementById("create_file_button").style.display = "none";
	}

	async function edit_selected_files() {
		var paths = "";
		var count = 0;
		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				if(explorer_files[f][0]) {
					await notify("cannot edit directories");
				}
				else {
					++count;
					await edit_file(bwd + "/" + explorer_files[f][1]);
				}
			}
		}

		if(!count) {
			notify("nothing selected")
		}
	}

	async function extract_paths() {
		var paths = "";
		var count = 0;
		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				++count;
				var ext = explorer_files[f][1].substring(explorer_files[f][1].indexOf('.'), explorer_files[f][1].length);

				const date = new Date().getTime().toString();
				const formData = new FormData();
				formData.append("date", date);

				if(ext == ".zip") 
					formData.append("command", "cd " + bwd + "; unzip " + explorer_files[f][1]);
				else 
					formData.append("command", "cd " + bwd + "; tar -xf " + explorer_files[f][1]);

				response = await fetch("/api/run", {
					method: "POST",
					headers: {
						//"content-type": "application/json"
						"signature": signature(date)
				    },
					body: formData
				});
				result = await response.json();

				if(result["output"] != "") {
					notify(result["output"].replaceAll("\n", "<br>"));
				}
			}
		}

		if(!count) {
			notify("nothing selected")
		}

		get_dir(bwd);
	}

	async function compress_paths() {
		var paths = "";
		var first = true;
		var count = 0;
		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				if(first)
					first = false;
				else
					paths += " ";
				paths += explorer_files[f][1];
				document.getElementById('checkbox-' + f).checked = false;
				++count;
			}
		}

		if(count) {
			const date = new Date().getTime().toString();
			const formData = new FormData();
			formData.append("date", date);
			//https://stackoverflow.com/a/27785347
			if(document.getElementById("select-compress").value == ".tar.xz") {
				formData.append("command", "tar -C " + bwd + "/ -c " + paths + " | xz > " + bwd + "/" + document.getElementById("input-name-compress").value + ".tar.xz");
			}
			else if(document.getElementById("select-compress").value == ".tar.gz") {
				formData.append("command", "tar -czf " + bwd + "/" + document.getElementById("input-name-compress").value + document.getElementById("select-compress").value + " -C " + bwd + "/ "  + paths);
			}
			else if(document.getElementById("select-compress").value == ".tar.bz2") {
				formData.append("command", "tar -C " + bwd + "/ -c " + paths + " | bzip2 > " + bwd + "/" + document.getElementById("input-name-compress").value + ".tar.bz2");
			}
			else if(document.getElementById("select-compress").value == ".zip") {
				formData.append("command", "cd " + bwd + "; zip -r " + bwd + "/" + document.getElementById("input-name-compress").value + ".zip " + paths);
			}

			response = await fetch("/api/run", {
				method: "POST",
				headers: {
					//"content-type": "application/json"
					"signature": signature(date)
			    },
				body: formData
			});
			result = await response.json();

			get_dir(bwd);
		}
		else {
			notify("nothing selected")
		}

		document.getElementById("input-mv-path").value = "";
		document.getElementById("card-input-mv").style.display = "none";
	}

	async function upload_file() {
		const fileField = document.getElementById("input-file");

		if(!fileField.files.length) {
			notify("No file chosen");
			return;
		}

		waiting_popup("uploading " + fileField.value.split('\\').pop());

		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		formData.append("path", bwd + "/" + fileField.value.split('\\').pop());
		formData.append("file", fileField.files[0]);

		response = await fetch("/api/upload", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		resolve_waiting_popup();

		get_dir(bwd);

		document.getElementById("card-input-upload").style.display = "none";
	}

	async function fetch_url() {
		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		//formData.append("command", "wget -q -O " + bwd + "/" + document.getElementById("input-fetch-url").value.split('?')[0].split('/').pop() + " " + document.getElementById("input-fetch-url").value);
		formData.append("command", "cd " + bwd + "; wget " + document.getElementById("input-fetch-url").value);

		waiting_popup("downloading " + document.getElementById("input-fetch-url").value);

		response = await fetch("/api/run", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		resolve_waiting_popup();

		get_dir(bwd);

		document.getElementById("input-fetch-url").value = "";
		document.getElementById("card-fetch-url").style.display = "none";
	}

	async function open_in_terminal() {
		twd = bwd;
		document.getElementById("textarea-terminal").innerHTML += "\n";
		add_prompt();
		show('terminal');
	}

	async function explorer_run_cmd() {
		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		formData.append("command", "cd " + bwd + "; " + document.getElementById("input-explorer-cmd").value);


		waiting_popup(document.getElementById("input-explorer-cmd").value);

		response = await fetch("/api/run", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		resolve_waiting_popup();
		get_dir(bwd);

		document.getElementById("input-explorer-cmd").value = "";
		document.getElementById("card-run-cmd").style.display = "none";

		if(result["output"] != "") {
			await mono_notify(result["output"]);
		}
	}

	async function clear_downloads_table() {
		const downloads_table = document.getElementById("table-downloads");

		while(downloads_table.rows.length > 0)
			downloads_table.deleteRow(0);
	}

	async function download_files() {
		const downloads_table = document.getElementById("table-downloads");
		var r = 0;

		clear_downloads_table();

		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				if(explorer_files[f][0]) {
					await notify("cannot download directories");
				}
				else {
					const date = new Date().getTime().toString();
					const formData = new FormData();
					formData.append("date", date);
					formData.append("path", bwd + "/" + explorer_files[f][1]);

					response = await fetch("/api/download", {
						method: "POST",
						headers: {
							//"content-type": "application/json"
							"signature": signature(date)
					    },
						body: formData
					});
					var blob = await response.blob();

					var file = window.URL.createObjectURL(blob);

					var row = downloads_table.insertRow(0);
					row.insertCell(0).innerHTML = explorer_files[f][1];
					row.insertCell(1).innerHTML = "<a id='download-link-" + f + "' download><button class='btn'>download</button></a>";
					document.getElementById("download-link-"+ f).href = file;
					document.getElementById("download-link-"+ f).download = explorer_files[f][1];
					document.getElementById("download-link-"+ f).click();
					
	    			//window.location.assign(file);
				}
			}
		}
	}

	async function rename_path() {
		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		formData.append("path-old", bwd + "/" + document.getElementById("input-name-current").value);
		formData.append("path-new", bwd + "/" + document.getElementById("input-name-new").value);

		response = await fetch("/api/rename", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		get_dir(bwd);

		document.getElementById("input-name-current").value = "";
		document.getElementById("input-name-new").value = "";
		document.getElementById("card-input-rename").style.display = "none";
	}

	async function duplicate_path() {
		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);
		formData.append("command", "cd " + bwd + "; cp -rf " + document.getElementById("input-name-current").value + " " + document.getElementById("input-name-new").value);

		response = await fetch("/api/run", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
			body: formData
		});
		result = await response.json();

		get_dir(bwd);

		document.getElementById("input-name-current").value = "";
		document.getElementById("input-name-new").value = "";
		document.getElementById("card-input-rename").style.display = "none";
	}

	async function mv_paths() {
		var paths = "";
		var first = true;
		var count = 0;
		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				if(first)
					first = false;
				else
					paths += " ";
				paths += bwd + "/" + explorer_files[f][1];
				document.getElementById('checkbox-' + f).checked = false;
				++count;
			}
		}

		if(count) {
			const date = new Date().getTime().toString();
			const formData = new FormData();
			formData.append("date", date);
			formData.append("paths", paths);
			formData.append("path", bwd + "/" + document.getElementById("input-mv-path").value);

			response = await fetch("/api/mv", {
				method: "POST",
				headers: {
					//"content-type": "application/json"
					"signature": signature(date)
			    },
				body: formData
			});
			result = await response.json();

			get_dir(bwd);
		}
		else {
			notify("nothing selected")
		}

		document.getElementById("input-mv-path").value = "";
		document.getElementById("card-input-mv").style.display = "none";
	}

	async function cp_paths() {
		var paths = "";
		var first = true;
		var count = 0;
		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				if(first)
					first = false;
				else
					paths += " ";
				paths += bwd + "/" + explorer_files[f][1];
				document.getElementById('checkbox-' + f).checked = false;
				++count;
			}
		}

		if(count) {
			const date = new Date().getTime().toString();
			const formData = new FormData();
			formData.append("date", date);
			formData.append("command", "cp -rf " + paths + " " + bwd + "/" + document.getElementById("input-mv-path").value);

			response = await fetch("/api/run", {
				method: "POST",
				headers: {
					//"content-type": "application/json"
					"signature": signature(date)
			    },
				body: formData
			});
			result = await response.json();

			get_dir(bwd);
		}
		else {
			notify("nothing selected")
		}

		document.getElementById("input-mv-path").value = "";
		document.getElementById("card-input-mv").style.display = "none";
	}

	async function rm_paths() {
		if(!await confirm_("permanently delete files?")) {
			return;
		}

		var paths = "";
		var first = true;
		var count = 0;
		for(var f=0; f<explorer_files.length; ++f) {
			if(document.getElementById('checkbox-' + f).checked) {
				if(first)
					first = false;
				else
					paths += " ";
				paths += bwd + "/" + explorer_files[f][1];
				document.getElementById('checkbox-' + f).checked = false;
				++count;
			}
		}

		if(count) {
			const date = new Date().getTime().toString();
			const formData = new FormData();
			formData.append("date", date);
			formData.append("paths", paths);

			response = await fetch("/api/rm", {
				method: "POST",
				headers: {
					//"content-type": "application/json"
					"signature": signature(date)
			    },
				body: formData
			});
			result = await response.json();

			get_dir(bwd);
		}
		else {
			notify("nothing selected")
		}
	}

	async function clear_explorer_table() {
		while(files_table.rows.length > 1)
			files_table.deleteRow(1);
	}

	async function get_dir(dir) {
		clear_explorer_table();

		const date = new Date().getTime().toString();
		const formData = new FormData();
		formData.append("date", date);

		bwd = dir;
		document.getElementById("span-pwd").innerHTML = "";
		var dirs = [], files = [];

		var cwd = bwd;
		if(cwd.substring(0, home.length) == home)
			    cwd = "~" + cwd.substring(home.length, cwd.length);

		while(cwd.lastIndexOf("/") >= 0) {
			dirs.push(cwd);
			files.push(cwd.substring(cwd.lastIndexOf('/')+1, cwd.length+1))
			//alert(cwd);
			//alert(cwd.substring(cwd.lastIndexOf('/')+1, cwd.length+1))
			cwd = cwd.substring(0, cwd.lastIndexOf('/'))
		}

		if(cwd == '~')
			document.getElementById("span-pwd").innerHTML += "<a href='#' onclick='get_dir(\"" + home + "\")'>~</a>/"
		else
			document.getElementById("span-pwd").innerHTML += "/"

		for(var i=dirs.length-1; i>=0; --i) {
			document.getElementById("span-pwd").innerHTML += "<a href='#' onclick='get_dir(\"" + dirs[i].replace("~", home) + "\")'>" + files[i] + "</a>/"
		}

		if(dir[0] == '~' && home.length)
			dir = home + dir.substring(1, dir.length);
		else if(dir == "")
			dir = "/";

		formData.append("dir", dir);
		response = await fetch("/api/ls", {
			method: "POST",
			headers: {
				//"content-type": "application/json"
				"signature": signature(date)
		    },
	        body: formData
		});
		result = await response.json();
		explorer_files = result["files"];

		for(var f=result["files"].length-1; f>=0; --f) {
			var row = files_table.insertRow(1);

			row.insertCell(0).innerHTML = "<input type='checkbox' id='checkbox-" + f + "' style='vertical-align: middle;'>"

			if(result["files"][f][0])
				row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-folder no-hover-ico' style='padding-top: 3px'></i>";
			else 
				row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-file-earmark no-hover-ico' style='padding-top: 3px'></i>";

			if(result["files"][f][0]) {
				row.insertCell(2).innerHTML = "<a href='#' onclick='get_dir(\"" + bwd + "/" + result["files"][f][1] +  "\")'>" + result["files"][f][1] + "/</a>";
			}
			else {
				row.insertCell(2).innerHTML = "<a href='#' onclick='edit_file(\"" + bwd + "/" + result["files"][f][1] +  "\")'>" + result["files"][f][1] + "</a>";
				//row.insertCell(1).innerHTML = result["files"][f][1];
			}

			if(result["files"][f][0]) {
				row.insertCell(3);
				row.insertCell(4);
			}
			else {
				if(result["files"][f][2] < 1000)
					row.insertCell(3).innerHTML = result["files"][f][2] + "b";
				else if(result["files"][f][2] < 1000000)
					row.insertCell(3).innerHTML = (result["files"][f][2]/1000).toFixed(2) + "kb";
				else
					row.insertCell(3).innerHTML = (result["files"][f][2]/1000000).toFixed(2) + "mb";

				row.insertCell(4).innerHTML = result["files"][f][3];
			}
		}

		if(dir != "/") 
		{
			var row = files_table.insertRow(1);
			var par = bwd.substring(0, bwd.lastIndexOf("/"));
			row.insertCell(0).innerHTML = "<input type='checkbox' id='checkbox-parent' disabled style='vertical-align: middle;'>";
			row.insertCell(1).innerHTML = "<i class='bs-ico ico-white width-1em default-cursor bootstrap-folder'></i>";
			row.insertCell(2).innerHTML = "<a href='#' onclick='get_dir(\"" + par + "\")'>../</a>";
			row.insertCell(3);
			row.insertCell(4);
		}
	}

	async function explorer_init() {
		bwd = pwd
	}
</script>