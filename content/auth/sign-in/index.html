<div id="sign-in-page">
	<div class="card" style="margin-top: 25vh">
		<h3>Admin Login</h3>

		<table class="centered">
			<tr>
				<td>
					<input 
						id="input-admin-url"
						type="text"
						placeholder="admin url" 
					>
				</td>
			</tr>
			<tr>
				<td>
					<input 
						id="input-email"
						type="email"
						placeholder="email" 
					>
				</td>
			</tr>
			<tr>
				<td>
					<input 
						id="input-password"
						type="password"
						placeholder="password" 
					>
				</td>
			</tr>
		</table>

		<div id="div-sign-in-failed" style="margin-top: 0.5em; display: none">
			sign in failed
		</div>

		<button onclick="sign_in()" style="margin-top: 0.5em">sign in</button>
	</div>
</div>

<script type="text/javascript" src="@pathtofile(dash/assets/js/pocketbase.umd.js)"></script>
<script>
	var pb;

	async function sign_in() {
		document.getElementById("div-sign-in-failed").style.display = "none";
		
		pb = new PocketBase(document.getElementById("input-admin-url").value);

		const authData = await pb.admins.authWithPassword(
	        document.getElementById("input-email").value,
	        document.getElementById("input-password").value,
	    ).then((response) => {
			if(response.error) {
				document.getElementById("div-sign-in-failed").innerHTML = "sign in failed"
				document.getElementById("div-sign-in-failed").style.display = "block";
				console.log(response.error.message)
			}
			else {
				localStorage.setItem("pb-url", document.getElementById("input-admin-url").value);
				window.location.href = "@pathto(/)";
			}
		}).catch((err) => {
			document.getElementById("div-sign-in-failed").innerHTML = "sign in failed"
			document.getElementById("div-sign-in-failed").style.display = "block";
			console.log(err);
		});

	    /*console.log(" isValid: " + pb.authStore.isValid);
	    console.log("   token: " + pb.authStore.token);
	    console.log("model.id: " + pb.authStore.model.id);*/
	}

	if(localStorage.getItem("pb-url")) {
		pb = new PocketBase(localStorage.getItem("pb-url"));
		if(pb.authStore.isValid) {
		    location.href = "../../"
		}
		else {
			document.getElementById("input-admin-url").value = localStorage.getItem("pb-url");
		}
	}
	else {
		document.getElementById("input-admin-url").value = window.location.protocol + "//" + window.location.hostname + ":8443";
	}

	document.addEventListener('keypress', (event) => {
	  var name = event.key;
	  var code = event.code;

	  if(name == 'Enter' || code == 'Enter')
	  	sign_in();
	}, false);
</script>